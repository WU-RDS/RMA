<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>5 Metrics and KPIs in retail | Retail Marketing Analytics 2024</title>
  <meta name="description" content="An Introduction to Data Analytics Using R" />
  <meta name="generator" content="bookdown 0.35 and GitBook 2.6.7" />

  <meta property="og:title" content="5 Metrics and KPIs in retail | Retail Marketing Analytics 2024" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="An Introduction to Data Analytics Using R" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="5 Metrics and KPIs in retail | Retail Marketing Analytics 2024" />
  
  <meta name="twitter:description" content="An Introduction to Data Analytics Using R" />
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
<link rel="prev" href="summarizing-data.html"/>
<link rel="next" href="statistical-inference.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="libs/pagedtable-1.1/js/pagedtable.js"></script>
<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<link href="libs/bsTable-3.3.7/bootstrapTable.min.css" rel="stylesheet" />
<script src="libs/bsTable-3.3.7/bootstrapTable.js"></script>
<script src="libs/htmlwidgets-1.6.2/htmlwidgets.js"></script>
<script src="libs/plotly-binding-4.10.2/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-2.11.1/plotly-latest.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><strong><a href="./">RMA 2023</a></strong></li>

<li class="divider"></li>
<li class="part"><span><b>I Course outline</b></span></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome!</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i>Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#course-structure"><i class="fa fa-check"></i>Course structure</a>
<ul>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#schedule"><i class="fa fa-check"></i>Schedule</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#grading"><i class="fa fa-check"></i>Grading</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#course-materials"><i class="fa fa-check"></i>Course materials</a>
<ul>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#main-reference"><i class="fa fa-check"></i>Main reference</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#further-readings"><i class="fa fa-check"></i>Further readings</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#discussion-forum"><i class="fa fa-check"></i>Discussion forum</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#other-web-resources"><i class="fa fa-check"></i>Other web-resources</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#contact"><i class="fa fa-check"></i>Contact</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#acknowledgements"><i class="fa fa-check"></i>Acknowledgements</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II Lecture notes</b></span></li>
<li class="chapter" data-level="1" data-path="preliminaries.html"><a href="preliminaries.html"><i class="fa fa-check"></i><b>1</b> Preliminaries</a>
<ul>
<li class="chapter" data-level="1.1" data-path="preliminaries.html"><a href="preliminaries.html#marketing-foundations-recap"><i class="fa fa-check"></i><b>1.1</b> Marketing foundations (recap)</a></li>
<li class="chapter" data-level="1.2" data-path="preliminaries.html"><a href="preliminaries.html#the-research-process"><i class="fa fa-check"></i><b>1.2</b> The research process</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="preliminaries.html"><a href="preliminaries.html#research-question-and-hypothesis"><i class="fa fa-check"></i><b>1.2.1</b> Research question and hypothesis</a></li>
<li class="chapter" data-level="1.2.2" data-path="preliminaries.html"><a href="preliminaries.html#choosing-a-research-design"><i class="fa fa-check"></i><b>1.2.2</b> Choosing a research design</a></li>
<li class="chapter" data-level="1.2.3" data-path="preliminaries.html"><a href="preliminaries.html#collecting-data"><i class="fa fa-check"></i><b>1.2.3</b> Collecting data</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="preliminaries.html"><a href="preliminaries.html#learning-check"><i class="fa fa-check"></i>Learning check</a></li>
<li class="chapter" data-level="" data-path="preliminaries.html"><a href="preliminaries.html#references"><i class="fa fa-check"></i>References</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="getting-started-with-r.html"><a href="getting-started-with-r.html"><i class="fa fa-check"></i><b>2</b> Getting started with R</a>
<ul>
<li class="chapter" data-level="2.1" data-path="getting-started-with-r.html"><a href="getting-started-with-r.html#how-to-download-and-install-r-and-rstudio"><i class="fa fa-check"></i><b>2.1</b> How to download and install R and RStudio</a></li>
<li class="chapter" data-level="2.2" data-path="getting-started-with-r.html"><a href="getting-started-with-r.html#the-r-studio-interface"><i class="fa fa-check"></i><b>2.2</b> The R Studio interface</a></li>
<li class="chapter" data-level="2.3" data-path="getting-started-with-r.html"><a href="getting-started-with-r.html#functions"><i class="fa fa-check"></i><b>2.3</b> Functions</a></li>
<li class="chapter" data-level="2.4" data-path="getting-started-with-r.html"><a href="getting-started-with-r.html#packages"><i class="fa fa-check"></i><b>2.4</b> Packages</a></li>
<li class="chapter" data-level="2.5" data-path="getting-started-with-r.html"><a href="getting-started-with-r.html#a-typical-r-session"><i class="fa fa-check"></i><b>2.5</b> A typical R session</a></li>
<li class="chapter" data-level="2.6" data-path="getting-started-with-r.html"><a href="getting-started-with-r.html#getting-help"><i class="fa fa-check"></i><b>2.6</b> Getting help</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="data-handling.html"><a href="data-handling.html"><i class="fa fa-check"></i><b>3</b> Data handling</a>
<ul>
<li class="chapter" data-level="3.1" data-path="data-handling.html"><a href="data-handling.html#basic-data-handling"><i class="fa fa-check"></i><b>3.1</b> Basic data handling</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="data-handling.html"><a href="data-handling.html#creating-objects"><i class="fa fa-check"></i><b>3.1.1</b> Creating objects</a></li>
<li class="chapter" data-level="3.1.2" data-path="data-handling.html"><a href="data-handling.html#data-types"><i class="fa fa-check"></i><b>3.1.2</b> Data types</a></li>
<li class="chapter" data-level="3.1.3" data-path="data-handling.html"><a href="data-handling.html#data-structures"><i class="fa fa-check"></i><b>3.1.3</b> Data structures</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="data-handling.html"><a href="data-handling.html#data-import-and-export"><i class="fa fa-check"></i><b>3.2</b> Data import and export</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="data-handling.html"><a href="data-handling.html#getting-data-for-this-course"><i class="fa fa-check"></i><b>3.2.1</b> Getting data for this course</a></li>
<li class="chapter" data-level="3.2.2" data-path="data-handling.html"><a href="data-handling.html#export-data"><i class="fa fa-check"></i><b>3.2.2</b> Export data</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="data-handling.html"><a href="data-handling.html#learning-check-1"><i class="fa fa-check"></i>Learning check</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="summarizing-data.html"><a href="summarizing-data.html"><i class="fa fa-check"></i><b>4</b> Summarizing data</a>
<ul>
<li class="chapter" data-level="4.1" data-path="summarizing-data.html"><a href="summarizing-data.html#summary-statistics"><i class="fa fa-check"></i><b>4.1</b> Summary statistics</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="summarizing-data.html"><a href="summarizing-data.html#categorical-variables"><i class="fa fa-check"></i><b>4.1.1</b> Categorical variables</a></li>
<li class="chapter" data-level="4.1.2" data-path="summarizing-data.html"><a href="summarizing-data.html#continuous-variables"><i class="fa fa-check"></i><b>4.1.2</b> Continuous variables</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="summarizing-data.html"><a href="summarizing-data.html#data-visualization"><i class="fa fa-check"></i><b>4.2</b> Data visualization</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="summarizing-data.html"><a href="summarizing-data.html#categorical-variables-1"><i class="fa fa-check"></i><b>4.2.1</b> Categorical variables</a></li>
<li class="chapter" data-level="4.2.2" data-path="summarizing-data.html"><a href="summarizing-data.html#continuous-variables-1"><i class="fa fa-check"></i><b>4.2.2</b> Continuous variables</a></li>
<li class="chapter" data-level="4.2.3" data-path="summarizing-data.html"><a href="summarizing-data.html#saving-plots"><i class="fa fa-check"></i><b>4.2.3</b> Saving plots</a></li>
<li class="chapter" data-level="4.2.4" data-path="summarizing-data.html"><a href="summarizing-data.html#ggplot-extensions"><i class="fa fa-check"></i><b>4.2.4</b> ggplot extensions</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="summarizing-data.html"><a href="summarizing-data.html#learning-check-2"><i class="fa fa-check"></i>Learning check</a></li>
<li class="chapter" data-level="" data-path="summarizing-data.html"><a href="summarizing-data.html#references-1"><i class="fa fa-check"></i>References</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="metrics-and-kpis-in-retail.html"><a href="metrics-and-kpis-in-retail.html"><i class="fa fa-check"></i><b>5</b> Metrics and KPIs in retail</a>
<ul>
<li class="chapter" data-level="5.0.1" data-path="metrics-and-kpis-in-retail.html"><a href="metrics-and-kpis-in-retail.html#margins-profits"><i class="fa fa-check"></i><b>5.0.1</b> Margins &amp; Profits</a></li>
<li class="chapter" data-level="5.0.2" data-path="metrics-and-kpis-in-retail.html"><a href="metrics-and-kpis-in-retail.html#shares"><i class="fa fa-check"></i><b>5.0.2</b> Shares</a></li>
<li class="chapter" data-level="5.0.3" data-path="metrics-and-kpis-in-retail.html"><a href="metrics-and-kpis-in-retail.html#portfolio-management"><i class="fa fa-check"></i><b>5.0.3</b> Portfolio Management</a></li>
<li class="chapter" data-level="5.0.4" data-path="metrics-and-kpis-in-retail.html"><a href="metrics-and-kpis-in-retail.html#pricing"><i class="fa fa-check"></i><b>5.0.4</b> Pricing</a></li>
<li class="chapter" data-level="5.0.5" data-path="metrics-and-kpis-in-retail.html"><a href="metrics-and-kpis-in-retail.html#finance"><i class="fa fa-check"></i><b>5.0.5</b> Finance</a></li>
<li class="chapter" data-level="5.0.6" data-path="metrics-and-kpis-in-retail.html"><a href="metrics-and-kpis-in-retail.html#categorical-variables-2"><i class="fa fa-check"></i><b>5.0.6</b> Categorical variables</a></li>
<li class="chapter" data-level="5.0.7" data-path="metrics-and-kpis-in-retail.html"><a href="metrics-and-kpis-in-retail.html#continuous-variables-2"><i class="fa fa-check"></i><b>5.0.7</b> Continuous variables</a></li>
<li class="chapter" data-level="5.0.8" data-path="metrics-and-kpis-in-retail.html"><a href="metrics-and-kpis-in-retail.html#saving-plots-1"><i class="fa fa-check"></i><b>5.0.8</b> Saving plots</a></li>
<li class="chapter" data-level="5.0.9" data-path="metrics-and-kpis-in-retail.html"><a href="metrics-and-kpis-in-retail.html#ggplot-extensions-1"><i class="fa fa-check"></i><b>5.0.9</b> ggplot extensions</a></li>
<li class="chapter" data-level="" data-path="metrics-and-kpis-in-retail.html"><a href="metrics-and-kpis-in-retail.html#learning-check-3"><i class="fa fa-check"></i>Learning check</a></li>
<li class="chapter" data-level="" data-path="metrics-and-kpis-in-retail.html"><a href="metrics-and-kpis-in-retail.html#references-2"><i class="fa fa-check"></i>References</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="statistical-inference.html"><a href="statistical-inference.html"><i class="fa fa-check"></i><b>6</b> Statistical inference</a>
<ul>
<li class="chapter" data-level="6.1" data-path="statistical-inference.html"><a href="statistical-inference.html#if-we-knew-it-all"><i class="fa fa-check"></i><b>6.1</b> If we knew it all</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="statistical-inference.html"><a href="statistical-inference.html#sampling-from-a-known-population"><i class="fa fa-check"></i><b>6.1.1</b> Sampling from a known population</a></li>
<li class="chapter" data-level="6.1.2" data-path="statistical-inference.html"><a href="statistical-inference.html#standard-error-of-the-mean"><i class="fa fa-check"></i><b>6.1.2</b> Standard error of the mean</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="statistical-inference.html"><a href="statistical-inference.html#the-central-limit-theorem"><i class="fa fa-check"></i><b>6.2</b> The Central Limit Theorem</a></li>
<li class="chapter" data-level="6.3" data-path="statistical-inference.html"><a href="statistical-inference.html#using-what-we-actually-know"><i class="fa fa-check"></i><b>6.3</b> Using what we actually know</a></li>
<li class="chapter" data-level="6.4" data-path="statistical-inference.html"><a href="statistical-inference.html#confidence-intervals-for-the-sample-mean"><i class="fa fa-check"></i><b>6.4</b> Confidence Intervals for the Sample Mean</a></li>
<li class="chapter" data-level="" data-path="statistical-inference.html"><a href="statistical-inference.html#learning-check-4"><i class="fa fa-check"></i>Learning check</a></li>
<li class="chapter" data-level="" data-path="statistical-inference.html"><a href="statistical-inference.html#references-3"><i class="fa fa-check"></i>References</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="supervised-learning.html"><a href="supervised-learning.html"><i class="fa fa-check"></i><b>7</b> Supervised learning</a>
<ul>
<li class="chapter" data-level="7.1" data-path="supervised-learning.html"><a href="supervised-learning.html#linear-regression"><i class="fa fa-check"></i><b>7.1</b> Linear regression</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="supervised-learning.html"><a href="supervised-learning.html#correlation"><i class="fa fa-check"></i><b>7.1.1</b> Correlation</a></li>
<li class="chapter" data-level="7.1.2" data-path="supervised-learning.html"><a href="supervised-learning.html#regression-analysis"><i class="fa fa-check"></i><b>7.1.2</b> Regression analysis</a></li>
<li class="chapter" data-level="7.1.3" data-path="supervised-learning.html"><a href="supervised-learning.html#categorical-predictors"><i class="fa fa-check"></i><b>7.1.3</b> Categorical predictors</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="supervised-learning.html"><a href="supervised-learning.html#logistic-regression"><i class="fa fa-check"></i><b>7.2</b> Logistic regression</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="supervised-learning.html"><a href="supervised-learning.html#motivation-and-intuition"><i class="fa fa-check"></i><b>7.2.1</b> Motivation and intuition</a></li>
<li class="chapter" data-level="7.2.2" data-path="supervised-learning.html"><a href="supervised-learning.html#technical-details-of-the-model"><i class="fa fa-check"></i><b>7.2.2</b> Technical details of the model</a></li>
<li class="chapter" data-level="7.2.3" data-path="supervised-learning.html"><a href="supervised-learning.html#estimation-in-r"><i class="fa fa-check"></i><b>7.2.3</b> Estimation in R</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="supervised-learning.html"><a href="supervised-learning.html#learning-check-5"><i class="fa fa-check"></i>Learning check</a></li>
<li class="chapter" data-level="" data-path="supervised-learning.html"><a href="supervised-learning.html#references-4"><i class="fa fa-check"></i>References</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="unsupervised-learning.html"><a href="unsupervised-learning.html"><i class="fa fa-check"></i><b>8</b> Unsupervised learning</a>
<ul>
<li class="chapter" data-level="8.1" data-path="unsupervised-learning.html"><a href="unsupervised-learning.html#principal-component-analysis"><i class="fa fa-check"></i><b>8.1</b> Principal component analysis</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="unsupervised-learning.html"><a href="unsupervised-learning.html#introduction-1"><i class="fa fa-check"></i><b>8.1.1</b> Introduction</a></li>
<li class="chapter" data-level="8.1.2" data-path="unsupervised-learning.html"><a href="unsupervised-learning.html#steps-in-factor-analysis"><i class="fa fa-check"></i><b>8.1.2</b> Steps in factor analysis</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="unsupervised-learning.html"><a href="unsupervised-learning.html#cluster-analysis"><i class="fa fa-check"></i><b>8.2</b> Cluster analysis</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="unsupervised-learning.html"><a href="unsupervised-learning.html#k-means"><i class="fa fa-check"></i><b>8.2.1</b> K-Means</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="unsupervised-learning.html"><a href="unsupervised-learning.html#learning-check-6"><i class="fa fa-check"></i>Learning check</a></li>
<li class="chapter" data-level="" data-path="unsupervised-learning.html"><a href="unsupervised-learning.html#references-5"><i class="fa fa-check"></i>References</a></li>
</ul></li>
<li class="part"><span><b>III Assignments</b></span></li>
<li class="chapter" data-level="9" data-path="r-markdown.html"><a href="r-markdown.html"><i class="fa fa-check"></i><b>9</b> R Markdown</a>
<ul>
<li class="chapter" data-level="9.1" data-path="r-markdown.html"><a href="r-markdown.html#introduction-to-r-markdown"><i class="fa fa-check"></i><b>9.1</b> Introduction to R Markdown</a>
<ul>
<li class="chapter" data-level="" data-path="r-markdown.html"><a href="r-markdown.html#creating-a-new-r-markdown-document"><i class="fa fa-check"></i>Creating a new R Markdown document</a></li>
<li class="chapter" data-level="" data-path="r-markdown.html"><a href="r-markdown.html#text-and-equations"><i class="fa fa-check"></i>Text and Equations</a></li>
<li class="chapter" data-level="" data-path="r-markdown.html"><a href="r-markdown.html#r-code"><i class="fa fa-check"></i>R-Code</a></li>
<li class="chapter" data-level="" data-path="r-markdown.html"><a href="r-markdown.html#latex-math"><i class="fa fa-check"></i>LaTeX Math</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="assignment-solutions.html"><a href="assignment-solutions.html"><i class="fa fa-check"></i><b>10</b> Assignment solutions</a>
<ul>
<li class="chapter" data-level="10.1" data-path="assignment-solutions.html"><a href="assignment-solutions.html#assignment-1"><i class="fa fa-check"></i><b>10.1</b> Assignment 1</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="assignment-solutions.html"><a href="assignment-solutions.html#q1"><i class="fa fa-check"></i><b>10.1.1</b> Q1</a></li>
<li class="chapter" data-level="10.1.2" data-path="assignment-solutions.html"><a href="assignment-solutions.html#q2"><i class="fa fa-check"></i><b>10.1.2</b> Q2</a></li>
<li class="chapter" data-level="10.1.3" data-path="assignment-solutions.html"><a href="assignment-solutions.html#q3"><i class="fa fa-check"></i><b>10.1.3</b> Q3</a></li>
<li class="chapter" data-level="10.1.4" data-path="assignment-solutions.html"><a href="assignment-solutions.html#q4"><i class="fa fa-check"></i><b>10.1.4</b> Q4</a></li>
<li class="chapter" data-level="10.1.5" data-path="assignment-solutions.html"><a href="assignment-solutions.html#q5"><i class="fa fa-check"></i><b>10.1.5</b> Q5</a></li>
<li class="chapter" data-level="10.1.6" data-path="assignment-solutions.html"><a href="assignment-solutions.html#q6"><i class="fa fa-check"></i><b>10.1.6</b> Q6</a></li>
<li class="chapter" data-level="10.1.7" data-path="assignment-solutions.html"><a href="assignment-solutions.html#q7"><i class="fa fa-check"></i><b>10.1.7</b> Q7</a></li>
<li class="chapter" data-level="10.1.8" data-path="assignment-solutions.html"><a href="assignment-solutions.html#q8"><i class="fa fa-check"></i><b>10.1.8</b> Q8</a></li>
<li class="chapter" data-level="10.1.9" data-path="assignment-solutions.html"><a href="assignment-solutions.html#q9"><i class="fa fa-check"></i><b>10.1.9</b> Q9</a></li>
<li class="chapter" data-level="10.1.10" data-path="assignment-solutions.html"><a href="assignment-solutions.html#q10"><i class="fa fa-check"></i><b>10.1.10</b> Q10</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="assignment-solutions.html"><a href="assignment-solutions.html#assignment-2"><i class="fa fa-check"></i><b>10.2</b> Assignment 2</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="assignment-solutions.html"><a href="assignment-solutions.html#q1-1"><i class="fa fa-check"></i><b>10.2.1</b> Q1</a></li>
<li class="chapter" data-level="10.2.2" data-path="assignment-solutions.html"><a href="assignment-solutions.html#q2-1"><i class="fa fa-check"></i><b>10.2.2</b> Q2</a></li>
<li class="chapter" data-level="10.2.3" data-path="assignment-solutions.html"><a href="assignment-solutions.html#q3-1"><i class="fa fa-check"></i><b>10.2.3</b> Q3</a></li>
<li class="chapter" data-level="10.2.4" data-path="assignment-solutions.html"><a href="assignment-solutions.html#q4-1"><i class="fa fa-check"></i><b>10.2.4</b> Q4</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="group-project-1.html"><a href="group-project-1.html"><i class="fa fa-check"></i><b>11</b> Group project</a>
<ul>
<li class="chapter" data-level="11.1" data-path="group-project-1.html"><a href="group-project-1.html#data-analysis"><i class="fa fa-check"></i><b>11.1</b> Data analysis</a></li>
<li class="chapter" data-level="11.2" data-path="group-project-1.html"><a href="group-project-1.html#load-data"><i class="fa fa-check"></i><b>11.2</b> Load data</a></li>
<li class="chapter" data-level="11.3" data-path="group-project-1.html"><a href="group-project-1.html#question-1"><i class="fa fa-check"></i><b>11.3</b> Question 1</a></li>
<li class="chapter" data-level="11.4" data-path="group-project-1.html"><a href="group-project-1.html#question-2"><i class="fa fa-check"></i><b>11.4</b> Question 2</a></li>
<li class="chapter" data-level="11.5" data-path="group-project-1.html"><a href="group-project-1.html#question-3"><i class="fa fa-check"></i><b>11.5</b> Question 3</a></li>
<li class="chapter" data-level="11.6" data-path="group-project-1.html"><a href="group-project-1.html#question-4"><i class="fa fa-check"></i><b>11.6</b> Question 4</a></li>
</ul></li>
<li class="part"><span><b>IV FAQ</b></span></li>
<li class="chapter" data-level="12" data-path="faq.html"><a href="faq.html"><i class="fa fa-check"></i><b>12</b> FAQ</a>
<ul>
<li class="chapter" data-level="12.1" data-path="faq.html"><a href="faq.html#common-error-messages"><i class="fa fa-check"></i><b>12.1</b> Common error messages</a>
<ul>
<li class="chapter" data-level="" data-path="faq.html"><a href="faq.html#a-general-note-on-error-messages"><i class="fa fa-check"></i>A general note on error messages</a></li>
<li class="chapter" data-level="" data-path="faq.html"><a href="faq.html#error-in-filefile-rt-cannot-open-the-connection"><i class="fa fa-check"></i>Error in file(file, “rt”): cannot open the connection</a></li>
<li class="chapter" data-level="" data-path="faq.html"><a href="faq.html#error-unexpected-symbol-in-call"><i class="fa fa-check"></i>Error: unexpected ‘SYMBOL’ in “CALL”</a></li>
<li class="chapter" data-level="" data-path="faq.html"><a href="faq.html#error-in-call-object-of-type-closure-is-not-subsettable"><i class="fa fa-check"></i>Error in CALL : object of type ‘closure’ is not subsettable</a></li>
<li class="chapter" data-level="" data-path="faq.html"><a href="faq.html#error-in-call_with_-operator-is-invalid-for-atomic-vectors"><i class="fa fa-check"></i>Error in CALL_WITH_$: $ operator is invalid for atomic vectors</a></li>
<li class="chapter" data-level="" data-path="faq.html"><a href="faq.html#error-in-call-object-name-not-found"><i class="fa fa-check"></i>Error in CALL: object ‘NAME’ not found</a></li>
<li class="chapter" data-level="" data-path="faq.html"><a href="faq.html#error-in-call-could-not-find-function-function"><i class="fa fa-check"></i>Error in CALL: could not find function “FUNCTION”</a></li>
<li class="chapter" data-level="" data-path="faq.html"><a href="faq.html#error-in-call-incorrect-number-of-dimension"><i class="fa fa-check"></i>Error in CALL: incorrect number of dimension</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="faq.html"><a href="faq.html#installation-of-r-packages"><i class="fa fa-check"></i><b>12.2</b> Installation of R packages</a>
<ul>
<li class="chapter" data-level="" data-path="faq.html"><a href="faq.html#what-are-the-different-ways-to-install-r-packages"><i class="fa fa-check"></i>What are the different ways to install R packages?</a></li>
<li class="chapter" data-level="" data-path="faq.html"><a href="faq.html#i-cannot-install-packages-due-to-error-in-contrib.urlrepossource-or-warning-message-package-packagename-is-not-available-for-this-version-of-r"><i class="fa fa-check"></i>I cannot install packages due to “Error in contrib.url(repos,”source”)” or “Warning message: package ‘PACKAGENAME’ is not available for this version of R”</a></li>
<li class="chapter" data-level="" data-path="faq.html"><a href="faq.html#some-libraries-with-graphical-output-e.g.-summarytools-magick-fail-to-installload-properly-on-macos"><i class="fa fa-check"></i>Some libraries with graphical output (e.g., summarytools, magick) fail to install/load properly on MacOS</a></li>
<li class="chapter" data-level="" data-path="faq.html"><a href="faq.html#i-cannot-install-some-packages-on-macos"><i class="fa fa-check"></i>I cannot install some packages on MacOS</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="faq.html"><a href="faq.html#issues-with-statistics-and-data"><i class="fa fa-check"></i><b>12.3</b> Issues with statistics and data</a>
<ul>
<li class="chapter" data-level="" data-path="faq.html"><a href="faq.html#why-does-a-multi-item-scale-lead-to-increased-reliability"><i class="fa fa-check"></i>Why does a multi-item scale lead to increased reliability?</a></li>
<li class="chapter" data-level="" data-path="faq.html"><a href="faq.html#why-can-demeaningstandardization-lead-to-missing-values"><i class="fa fa-check"></i>Why can demeaning/standardization lead to missing values?</a></li>
<li class="chapter" data-level="" data-path="faq.html"><a href="faq.html#the-confidence-interval-ci-of-the-mean-seems-very-small-compared-to-the-dispersion-of-my-sample.-can-this-be-correct"><i class="fa fa-check"></i>The confidence interval (CI) of the mean seems very small compared to the dispersion of my sample. Can this be correct?</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="faq.html"><a href="faq.html#errors-related-to-specific-methods"><i class="fa fa-check"></i><b>12.4</b> Errors related to specific methods</a>
<ul>
<li class="chapter" data-level="" data-path="faq.html"><a href="faq.html#logistic-regression-1"><i class="fa fa-check"></i>Logistic regression</a></li>
<li class="chapter" data-level="" data-path="faq.html"><a href="faq.html#when-using-logistic-regression-error-in-weights-y-non-numeric-argument-to-binary-operator"><i class="fa fa-check"></i>When using logistic regression: Error in weights * y : non-numeric argument to binary operator</a></li>
</ul></li>
<li class="chapter" data-level="12.5" data-path="faq.html"><a href="faq.html#general-settings-and-options"><i class="fa fa-check"></i><b>12.5</b> General settings and options</a>
<ul>
<li class="chapter" data-level="" data-path="faq.html"><a href="faq.html#numbers-are-formatted-weirdly"><i class="fa fa-check"></i>Numbers are formatted weirdly</a></li>
</ul></li>
<li class="chapter" data-level="12.6" data-path="faq.html"><a href="faq.html#data-visualizationoutput-issues"><i class="fa fa-check"></i><b>12.6</b> Data visualization/output issues</a>
<ul>
<li class="chapter" data-level="" data-path="faq.html"><a href="faq.html#how-can-the-geom-colors-in-a-ggplot-be-changed"><i class="fa fa-check"></i>How can the <code>geom</code> colors in a <code>ggplot</code> be changed?</a></li>
<li class="chapter" data-level="" data-path="faq.html"><a href="faq.html#why-are-some-histograms-displayed-differently"><i class="fa fa-check"></i>Why are some histograms displayed differently?</a></li>
<li class="chapter" data-level="" data-path="faq.html"><a href="faq.html#some-labels-in-plots-are-cut-off.-how-can-i-extend-the-plot-margins"><i class="fa fa-check"></i>Some labels in plots are cut off. How can I extend the plot margins?</a></li>
</ul></li>
<li class="chapter" data-level="12.7" data-path="faq.html"><a href="faq.html#issues-with-functions-and-function-arguments"><i class="fa fa-check"></i><b>12.7</b> Issues with functions and function arguments</a>
<ul>
<li class="chapter" data-level="" data-path="faq.html"><a href="faq.html#problems-with-factor-and-as.factor"><i class="fa fa-check"></i>Problems with <code>factor</code> and <code>as.factor</code></a></li>
<li class="chapter" data-level="" data-path="faq.html"><a href="faq.html#how-can-i-find-an-explanation-of-the-output-of-a-function"><i class="fa fa-check"></i>How can I find an explanation of the output of a function?</a></li>
<li class="chapter" data-level="" data-path="faq.html"><a href="faq.html#what-does-the-margin-argument-do"><i class="fa fa-check"></i>What does the <code>MARGIN</code> argument do?</a></li>
</ul></li>
<li class="chapter" data-level="12.8" data-path="faq.html"><a href="faq.html#issues-with-r-markdown"><i class="fa fa-check"></i><b>12.8</b> Issues with R Markdown</a>
<ul>
<li class="chapter" data-level="" data-path="faq.html"><a href="faq.html#i-get-an-error-when-knitting-to-pdf-but-it-works-for-html"><i class="fa fa-check"></i>I get an error when <code>knit</code>ting to PDF but it works for HTML</a></li>
<li class="chapter" data-level="" data-path="faq.html"><a href="faq.html#i-am-not-sure-where-r-code-latex-math-and-text-go"><i class="fa fa-check"></i>I am not sure where R-code, LaTeX math, and text go</a></li>
</ul></li>
<li class="chapter" data-level="12.9" data-path="faq.html"><a href="faq.html#new-questions"><i class="fa fa-check"></i><b>12.9</b> New questions</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Retail Marketing Analytics 2024</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="metrics-and-kpis-in-retail" class="section level1 hasAnchor" number="5">
<h1><span class="header-section-number">5</span> Metrics and KPIs in retail<a href="metrics-and-kpis-in-retail.html#metrics-and-kpis-in-retail" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>In the dynamic landscape of retail, success hinges on the ability to adapt swiftly to changing consumer behavior, market trends, and competitive landscapes. The emergence of technology and the digital era has given rise to an unprecedented amount of data, providing retailers with the opportunity to gain valuable insights into their operations. To navigate this vast sea of information effectively, it is crucial for retail marketers to employ analytical tools and metrics that not only measure performance but also illuminate areas for improvement.</p>
<p>The primary motivation behind measuring specific Key Performance Indicators (KPIs) in retail analytics lies in the quest for actionable insights. <em>“If you can’t measure it, you can’t manage it”</em> is a controversial yet famous and widely spread quote. Retailers seek to optimize various aspects of their operations, ranging from inventory management to customer engagement, ultimately aiming to enhance the overall customer experience and drive profitability. While there are hundreds of metrics, related to retail business, it is also important to define the range of those that really matter in a particular situation - or even in general. By leveraging relevant metrics, retailers can make informed decisions, identify patterns, and respond proactively to market changes.</p>
<p>This chapter provides an overview of metrics, their area of importance, and relevance.</p>
<div id="margins-profits" class="section level3 hasAnchor" number="5.0.1">
<h3><span class="header-section-number">5.0.1</span> Margins &amp; Profits<a href="metrics-and-kpis-in-retail.html#margins-profits" class="anchor-section" aria-label="Anchor link to header"></a></h3>
</div>
<div id="shares" class="section level3 hasAnchor" number="5.0.2">
<h3><span class="header-section-number">5.0.2</span> Shares<a href="metrics-and-kpis-in-retail.html#shares" class="anchor-section" aria-label="Anchor link to header"></a></h3>
</div>
<div id="portfolio-management" class="section level3 hasAnchor" number="5.0.3">
<h3><span class="header-section-number">5.0.3</span> Portfolio Management<a href="metrics-and-kpis-in-retail.html#portfolio-management" class="anchor-section" aria-label="Anchor link to header"></a></h3>
</div>
<div id="pricing" class="section level3 hasAnchor" number="5.0.4">
<h3><span class="header-section-number">5.0.4</span> Pricing<a href="metrics-and-kpis-in-retail.html#pricing" class="anchor-section" aria-label="Anchor link to header"></a></h3>
</div>
<div id="finance" class="section level3 hasAnchor" number="5.0.5">
<h3><span class="header-section-number">5.0.5</span> Finance<a href="metrics-and-kpis-in-retail.html#finance" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The plots we created in the previous chapters used R’s in-built functions. In this section, we will be using the <code>ggplot2</code> package by Hadley Wickham. It has the advantage of being fairly straightforward to learn and being very flexible when it comes to building more complex plots. For a more in depth discussion you can refer to chapter 4 of the book “Discovering Statistics Using R” by Andy Field et al. or read the following chapter from the book <a href="http://r4ds.had.co.nz/data-visualisation.html" target="_blank">“R for Data science”</a> by Hadley Wickham as well as <a href="https://r-graphics.org/" target="_blank">“R Graphics Cookbook”</a> by Winston Chang.</p>
<p>ggplot2 is built around the idea of constructing plots by stacking layers on top of one another. Every plot starts with the <code>ggplot(data)</code> function, after which layers can be added with the “+” symbol. The following figures show the layered structure of creating plots with ggplot.</p>
<p style="text-align:center;">
<img src="https://github.com/IMSMWU/Teaching/raw/master/MRDA2017/Graphics/ggplot2.JPG" alt="DSUR cover" height="250"  />   
<img src="https://github.com/IMSMWU/Teaching/raw/master/MRDA2017/Graphics/ggplot1.JPG" alt="DSUR cover" height="250"  />
</p>
</div>
<div id="categorical-variables-2" class="section level3 hasAnchor" number="5.0.6">
<h3><span class="header-section-number">5.0.6</span> Categorical variables<a href="metrics-and-kpis-in-retail.html#categorical-variables-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<br>
<div align="center">
<iframe width="560" height="315" src="https://www.youtube-nocookie.com/embed/FCx9yrkwm68" frameborder="0" allowfullscreen>
</iframe>
</div>
<p><br></p>
<div id="bar-plot-1" class="section level4 hasAnchor" number="5.0.6.1">
<h4><span class="header-section-number">5.0.6.1</span> Bar plot<a href="metrics-and-kpis-in-retail.html#bar-plot-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>To give you an example of how the graphics are composed, let’s go back to the frequency table from the previous chapter, where we created a table showing the relative frequencies of songs in the Austrian streaming charts by genre.</p>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="metrics-and-kpis-in-retail.html#cb180-1" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb180-2"><a href="metrics-and-kpis-in-retail.html#cb180-2" tabindex="-1"></a>music_data <span class="ot">&lt;-</span> <span class="fu">read.csv2</span>(<span class="st">&quot;https://short.wu.ac.at/ma22_musicdata&quot;</span>) <span class="sc">|&gt;</span> <span class="co"># pipe music data into mutate</span></span>
<span id="cb180-3"><a href="metrics-and-kpis-in-retail.html#cb180-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">release_date =</span> <span class="fu">as.Date</span>(release_date), <span class="co"># convert to date</span></span>
<span id="cb180-4"><a href="metrics-and-kpis-in-retail.html#cb180-4" tabindex="-1"></a>         <span class="at">explicit =</span> <span class="fu">factor</span>(explicit, <span class="at">levels =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;not explicit&quot;</span>, <span class="st">&quot;explicit&quot;</span>)), <span class="co"># convert to factor w. new labels</span></span>
<span id="cb180-5"><a href="metrics-and-kpis-in-retail.html#cb180-5" tabindex="-1"></a>         <span class="at">label =</span> <span class="fu">as.factor</span>(label), <span class="co"># convert to factor with values as labels</span></span>
<span id="cb180-6"><a href="metrics-and-kpis-in-retail.html#cb180-6" tabindex="-1"></a>         <span class="at">genre =</span> <span class="fu">as.factor</span>(genre),</span>
<span id="cb180-7"><a href="metrics-and-kpis-in-retail.html#cb180-7" tabindex="-1"></a>         <span class="at">top10 =</span> <span class="fu">as.logical</span>(top10),</span>
<span id="cb180-8"><a href="metrics-and-kpis-in-retail.html#cb180-8" tabindex="-1"></a>         <span class="co"># Create an ordered factor for the ratings (e.g., for arranging the data)</span></span>
<span id="cb180-9"><a href="metrics-and-kpis-in-retail.html#cb180-9" tabindex="-1"></a>         <span class="at">expert_rating =</span> <span class="fu">factor</span>(expert_rating, </span>
<span id="cb180-10"><a href="metrics-and-kpis-in-retail.html#cb180-10" tabindex="-1"></a>                                <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;poor&quot;</span>, <span class="st">&quot;fair&quot;</span>, <span class="st">&quot;good&quot;</span>, <span class="st">&quot;excellent&quot;</span>, <span class="st">&quot;masterpiece&quot;</span>), </span>
<span id="cb180-11"><a href="metrics-and-kpis-in-retail.html#cb180-11" tabindex="-1"></a>                                <span class="at">ordered =</span> <span class="cn">TRUE</span>)</span>
<span id="cb180-12"><a href="metrics-and-kpis-in-retail.html#cb180-12" tabindex="-1"></a>         ) <span class="sc">|&gt;</span></span>
<span id="cb180-13"><a href="metrics-and-kpis-in-retail.html#cb180-13" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(valence))</span>
<span id="cb180-14"><a href="metrics-and-kpis-in-retail.html#cb180-14" tabindex="-1"></a><span class="fu">head</span>(music_data)</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["isrc"],"name":[1],"type":["chr"],"align":["left"]},{"label":["artist_id"],"name":[2],"type":["int"],"align":["right"]},{"label":["streams"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["weeks_in_charts"],"name":[4],"type":["int"],"align":["right"]},{"label":["n_regions"],"name":[5],"type":["int"],"align":["right"]},{"label":["danceability"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["energy"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["speechiness"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["instrumentalness"],"name":[9],"type":["dbl"],"align":["right"]},{"label":["liveness"],"name":[10],"type":["dbl"],"align":["right"]},{"label":["valence"],"name":[11],"type":["dbl"],"align":["right"]},{"label":["tempo"],"name":[12],"type":["dbl"],"align":["right"]},{"label":["song_length"],"name":[13],"type":["dbl"],"align":["right"]},{"label":["song_age"],"name":[14],"type":["dbl"],"align":["right"]},{"label":["explicit"],"name":[15],"type":["fct"],"align":["left"]},{"label":["n_playlists"],"name":[16],"type":["int"],"align":["right"]},{"label":["sp_popularity"],"name":[17],"type":["int"],"align":["right"]},{"label":["youtube_views"],"name":[18],"type":["dbl"],"align":["right"]},{"label":["tiktok_counts"],"name":[19],"type":["int"],"align":["right"]},{"label":["ins_followers_artist"],"name":[20],"type":["int"],"align":["right"]},{"label":["monthly_listeners_artist"],"name":[21],"type":["int"],"align":["right"]},{"label":["playlist_total_reach_artist"],"name":[22],"type":["int"],"align":["right"]},{"label":["sp_fans_artist"],"name":[23],"type":["int"],"align":["right"]},{"label":["shazam_counts"],"name":[24],"type":["int"],"align":["right"]},{"label":["artistName"],"name":[25],"type":["chr"],"align":["left"]},{"label":["trackName"],"name":[26],"type":["chr"],"align":["left"]},{"label":["release_date"],"name":[27],"type":["date"],"align":["right"]},{"label":["genre"],"name":[28],"type":["fct"],"align":["left"]},{"label":["label"],"name":[29],"type":["fct"],"align":["left"]},{"label":["top10"],"name":[30],"type":["lgl"],"align":["right"]},{"label":["expert_rating"],"name":[31],"type":["ord"],"align":["right"]}],"data":[{"1":"BRRGE1603547","2":"3679","3":"11944813","4":"141","5":"1","6":"50.9","7":"80.3","8":"4.00","9":"0.050000","10":"46.30","11":"65.1","12":"166.018","13":"3.118650","14":"228.28571","15":"not explicit","16":"450","17":"51","18":"145030723","19":"9740","20":"29613108","21":"4133393","22":"24286416","23":"3308630","24":"73100","25":"Luan Santana","26":"Eu, Você, O Mar e Ela","27":"2016-06-20","28":"other","29":"Independent","30":"TRUE","31":"excellent"},{"1":"USUM71808193","2":"5239","3":"8934097","4":"51","5":"21","6":"35.3","7":"75.5","8":"73.30","9":"0.000000","10":"39.00","11":"43.7","12":"191.153","13":"3.228000","14":"144.28571","15":"not explicit","16":"768","17":"54","18":"13188411","19":"358700","20":"3693566","21":"18367363","22":"143384531","23":"465412","24":"588550","25":"Alessia Cara","26":"Growing Pains","27":"2018-06-14","28":"Pop","29":"Universal Music","30":"FALSE","31":"good"},{"1":"ES5701800181","2":"776407","3":"38835","4":"1","5":"1","6":"68.3","7":"67.6","8":"14.70","9":"0.000000","10":"7.26","11":"43.4","12":"98.992","13":"3.015550","14":"112.28571","15":"not explicit","16":"48","17":"32","18":"6116639","19":"0","20":"623778","21":"888273","22":"4846378","23":"23846","24":"0","25":"Ana Guerra","26":"El Remedio","27":"2018-04-26","28":"Pop","29":"Universal Music","30":"FALSE","31":"good"},{"1":"ITRSE2000050","2":"433730","3":"46766","4":"1","5":"1","6":"70.4","7":"56.8","8":"26.80","9":"0.000253","10":"8.91","11":"49.5","12":"91.007","13":"3.453417","14":"50.71429","15":"not explicit","16":"6","17":"44","18":"0","19":"13","20":"81601","21":"143761","22":"156521","23":"1294","24":"0","25":"Claver Gold feat. Murubutu","26":"Ulisse","27":"2020-03-31","28":"HipHop/Rap","29":"Independent","30":"FALSE","31":"poor"},{"1":"QZJ842000061","2":"526471","3":"2930573","4":"7","5":"4","6":"84.2","7":"57.8","8":"13.80","9":"0.000000","10":"22.80","11":"19.0","12":"74.496","13":"3.946317","14":"58.28571","15":"not explicit","16":"475","17":"52","18":"0","19":"515","20":"11962358","21":"15551876","22":"90841884","23":"380204","24":"55482","25":"Trippie Redd feat. Young Thug","26":"YELL OH","27":"2020-02-07","28":"HipHop/Rap","29":"Universal Music","30":"FALSE","31":"excellent"},{"1":"USIR20400274","2":"1939","3":"72199738","4":"226","5":"8","6":"35.2","7":"91.1","8":"7.47","9":"0.000000","10":"9.95","11":"23.6","12":"148.033","13":"3.716217","14":"876.71429","15":"not explicit","16":"20591","17":"81","18":"20216069","19":"67300","20":"1169284","21":"16224250","22":"80408253","23":"1651866","24":"5281161","25":"The Killers","26":"Mr. Brightside","27":"2004-06-07","28":"Rock","29":"Universal Music","30":"TRUE","31":"fair"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>How can we plot this kind of data? Since we have a categorical variable, we will use a bar plot. However, to be able to use the table for your plot, you first need to assign it to an object as a data frame using the <code>as.data.frame()</code>-function.</p>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb181-1"><a href="metrics-and-kpis-in-retail.html#cb181-1" tabindex="-1"></a>table_plot_rel <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">prop.table</span>(<span class="fu">table</span>(music_data<span class="sc">$</span>genre)))  <span class="co">#relative frequencies</span></span>
<span id="cb181-2"><a href="metrics-and-kpis-in-retail.html#cb181-2" tabindex="-1"></a><span class="fu">head</span>(table_plot_rel)</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["Var1"],"name":[1],"type":["fct"],"align":["left"]},{"label":["Freq"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"Classics/Jazz","2":"0.001197677"},{"1":"Country","2":"0.007545362"},{"1":"Electro/Dance","2":"0.040466495"},{"1":"German Folk","2":"0.008069345"},{"1":"HipHop/Rap","2":"0.316351279"},{"1":"other","2":"0.078268160"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Since <code>Var1</code> is not a very descriptive name, let’s rename the variable to something more meaningful</p>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="metrics-and-kpis-in-retail.html#cb182-1" tabindex="-1"></a>table_plot_rel <span class="ot">&lt;-</span> <span class="fu">rename</span>(table_plot_rel, <span class="at">Genre =</span> Var1)</span>
<span id="cb182-2"><a href="metrics-and-kpis-in-retail.html#cb182-2" tabindex="-1"></a><span class="fu">head</span>(table_plot_rel)</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["Genre"],"name":[1],"type":["fct"],"align":["left"]},{"label":["Freq"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"Classics/Jazz","2":"0.001197677"},{"1":"Country","2":"0.007545362"},{"1":"Electro/Dance","2":"0.040466495"},{"1":"German Folk","2":"0.008069345"},{"1":"HipHop/Rap","2":"0.316351279"},{"1":"other","2":"0.078268160"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Once we have our data set we can begin constructing the plot. As mentioned previously, we start with the <code>ggplot()</code> function, with the argument specifying the data set to be used. Within the function, we further specify the scales to be used using the aesthetics argument, specifying which variable should be plotted on which axis. In our example, we would like to plot the categories on the x-axis (horizontal axis) and the relative frequencies on the y-axis (vertical axis).</p>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb183-1"><a href="metrics-and-kpis-in-retail.html#cb183-1" tabindex="-1"></a>bar_chart <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(table_plot_rel, <span class="fu">aes</span>(<span class="at">x =</span> Genre,</span>
<span id="cb183-2"><a href="metrics-and-kpis-in-retail.html#cb183-2" tabindex="-1"></a>    <span class="at">y =</span> Freq))</span>
<span id="cb183-3"><a href="metrics-and-kpis-in-retail.html#cb183-3" tabindex="-1"></a>bar_chart</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-6"></span>
<img src="06-retail_metrics_files/figure-html/unnamed-chunk-6-1.png" alt="Bar chart (step 1)" width="672" />
<p class="caption">
Figure 5.1: Bar chart (step 1)
</p>
</div>
<p>You can see that the coordinate system is empty. This is because so far, we have told R only which variables we would like to plot but we haven’t specified which geometric figures (points, bars, lines, etc.) we would like to use. This is done using the <code>geom_xxx()</code> function. ggplot includes many different geoms, for a wide range of plots (e.g., geom_line, geom_histogram, geom_boxplot, etc.). A good overview of the various geom functions can be found <a href="https://github.com/rstudio/cheatsheets/blob/a9d72b61746ceabb94ef247af14b263ab5fbf15f/data-visualization-2.1.pdf" target="_blank">here</a>. In our case, we would like to use a bar chart for which <code>geom_col</code> is appropriate.</p>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="metrics-and-kpis-in-retail.html#cb184-1" tabindex="-1"></a>bar_chart <span class="sc">+</span> <span class="fu">geom_col</span>()</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-7"></span>
<img src="06-retail_metrics_files/figure-html/unnamed-chunk-7-1.png" alt="Bar chart (step 2)" width="672" />
<p class="caption">
Figure 1.5: Bar chart (step 2)
</p>
</div>
<p>Now we have specified the data, the scales and the shape. Specifying this information is essential for plotting data using ggplot. Everything that follows now just serves the purpose of making the plot look nicer by modifying the appearance of the plot. How about some more meaningful axis labels? We can specify the axis labels using the <code>ylab()</code> and <code>xlab()</code> functions:</p>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb185-1"><a href="metrics-and-kpis-in-retail.html#cb185-1" tabindex="-1"></a>bar_chart <span class="sc">+</span> <span class="fu">geom_col</span>() <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">&quot;Relative frequency&quot;</span>) <span class="sc">+</span></span>
<span id="cb185-2"><a href="metrics-and-kpis-in-retail.html#cb185-2" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">&quot;Genre&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-8"></span>
<img src="06-retail_metrics_files/figure-html/unnamed-chunk-8-1.png" alt="Bar chart (step 3)" width="672" />
<p class="caption">
Figure 1.6: Bar chart (step 3)
</p>
</div>
<p>How about adding some value labels to the bars? This can be done using <code>geom_text()</code>. Note that the <code>sprintf()</code> function is not mandatory and is only added to format the numeric labels here. The function takes two arguments: the first specifies the format wrapped in two <code>%</code> signs. Thus, <code>%.0f</code> means to format the value as a fixed point value with no digits after the decimal point, and <code>%%</code> is a literal that prints a “%” sign. The second argument is simply the numeric value to be used. In this case, the relative frequencies multiplied by 100 to obtain the percentage values. Using the <code>vjust =</code> argument, we can adjust the vertical alignment of the label. In this case, we would like to display the label slightly above the bars.</p>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="metrics-and-kpis-in-retail.html#cb186-1" tabindex="-1"></a>bar_chart <span class="sc">+</span> <span class="fu">geom_col</span>() <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">&quot;Relative frequency&quot;</span>) <span class="sc">+</span></span>
<span id="cb186-2"><a href="metrics-and-kpis-in-retail.html#cb186-2" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">&quot;Genre&quot;</span>) <span class="sc">+</span> <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">sprintf</span>(<span class="st">&quot;%.0f%%&quot;</span>,</span>
<span id="cb186-3"><a href="metrics-and-kpis-in-retail.html#cb186-3" tabindex="-1"></a>    Freq <span class="sc">*</span> <span class="dv">100</span>)), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.2</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-9"></span>
<img src="06-retail_metrics_files/figure-html/unnamed-chunk-9-1.png" alt="Bar chart (step 4)" width="672" />
<p class="caption">
Figure 1.7: Bar chart (step 4)
</p>
</div>
<p>We could go ahead and specify the appearance of every single element of the plot now. However, there are also pre-specified themes that include various formatting steps in one singe function. For example <code>theme_bw()</code> would make the plot appear like this:</p>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb187-1"><a href="metrics-and-kpis-in-retail.html#cb187-1" tabindex="-1"></a>bar_chart <span class="sc">+</span> <span class="fu">geom_col</span>() <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">&quot;Relative frequency&quot;</span>) <span class="sc">+</span></span>
<span id="cb187-2"><a href="metrics-and-kpis-in-retail.html#cb187-2" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">&quot;Genre&quot;</span>) <span class="sc">+</span> <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">sprintf</span>(<span class="st">&quot;%.1f%%&quot;</span>,</span>
<span id="cb187-3"><a href="metrics-and-kpis-in-retail.html#cb187-3" tabindex="-1"></a>    Freq<span class="sc">/</span><span class="fu">sum</span>(Freq) <span class="sc">*</span> <span class="dv">100</span>)), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.2</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>()</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-10"></span>
<img src="06-retail_metrics_files/figure-html/unnamed-chunk-10-1.png" alt="Bar chart (step 5)" width="672" />
<p class="caption">
Figure 1.8: Bar chart (step 5)
</p>
</div>
<p>and <code>theme_minimal()</code> looks like this:</p>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb188-1"><a href="metrics-and-kpis-in-retail.html#cb188-1" tabindex="-1"></a>bar_chart <span class="sc">+</span> <span class="fu">geom_col</span>() <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">&quot;Relative frequency&quot;</span>) <span class="sc">+</span></span>
<span id="cb188-2"><a href="metrics-and-kpis-in-retail.html#cb188-2" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">&quot;Genre&quot;</span>) <span class="sc">+</span> <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">sprintf</span>(<span class="st">&quot;%.1f%%&quot;</span>,</span>
<span id="cb188-3"><a href="metrics-and-kpis-in-retail.html#cb188-3" tabindex="-1"></a>    Freq<span class="sc">/</span><span class="fu">sum</span>(Freq) <span class="sc">*</span> <span class="dv">100</span>)), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.2</span>) <span class="sc">+</span> <span class="fu">theme_minimal</span>()</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-11"></span>
<img src="06-retail_metrics_files/figure-html/unnamed-chunk-11-1.png" alt="Bar chart (options 1)" width="672" />
<p class="caption">
Figure 1.9: Bar chart (options 1)
</p>
</div>
<p>In a next step, let’s prevent the axis labels from overlapping by rotating the labels.</p>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb189-1"><a href="metrics-and-kpis-in-retail.html#cb189-1" tabindex="-1"></a>bar_chart <span class="sc">+</span> <span class="fu">geom_col</span>() <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">&quot;Relative frequency&quot;</span>) <span class="sc">+</span></span>
<span id="cb189-2"><a href="metrics-and-kpis-in-retail.html#cb189-2" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">&quot;Genre&quot;</span>) <span class="sc">+</span> <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">sprintf</span>(<span class="st">&quot;%.1f%%&quot;</span>,</span>
<span id="cb189-3"><a href="metrics-and-kpis-in-retail.html#cb189-3" tabindex="-1"></a>    Freq<span class="sc">/</span><span class="fu">sum</span>(Freq) <span class="sc">*</span> <span class="dv">100</span>)), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.2</span>) <span class="sc">+</span> <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb189-4"><a href="metrics-and-kpis-in-retail.html#cb189-4" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">vjust =</span> <span class="fl">0.75</span>))</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-12"></span>
<img src="06-retail_metrics_files/figure-html/unnamed-chunk-12-1.png" alt="Bar chart (options 1)" width="672" />
<p class="caption">
Figure 1.10: Bar chart (options 1)
</p>
</div>
<p>We could also add a title and combine all labels using the <code>labs</code> function.</p>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb190-1"><a href="metrics-and-kpis-in-retail.html#cb190-1" tabindex="-1"></a>bar_chart <span class="sc">+</span> <span class="fu">geom_col</span>() <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Genre&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Relative frequency&quot;</span>,</span>
<span id="cb190-2"><a href="metrics-and-kpis-in-retail.html#cb190-2" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Chart songs by genre&quot;</span>) <span class="sc">+</span> <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">sprintf</span>(<span class="st">&quot;%.1f%%&quot;</span>,</span>
<span id="cb190-3"><a href="metrics-and-kpis-in-retail.html#cb190-3" tabindex="-1"></a>    Freq<span class="sc">/</span><span class="fu">sum</span>(Freq) <span class="sc">*</span> <span class="dv">100</span>)), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.2</span>) <span class="sc">+</span> <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb190-4"><a href="metrics-and-kpis-in-retail.html#cb190-4" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">vjust =</span> <span class="fl">0.75</span>),</span>
<span id="cb190-5"><a href="metrics-and-kpis-in-retail.html#cb190-5" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">&quot;#666666&quot;</span>))</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-13"></span>
<img src="06-retail_metrics_files/figure-html/unnamed-chunk-13-1.png" alt="Bar chart (options 1)" width="672" />
<p class="caption">
Figure 1.11: Bar chart (options 1)
</p>
</div>
<p>We could also add some color to the bars using the <code>colorspace</code> library, which comes with a range of <a href="https://colorspace.r-forge.r-project.org/articles/ggplot2_color_scales.html" target="_blank">color palettes</a>. For example the shading of the bar could reflect the frequency:</p>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb191-1"><a href="metrics-and-kpis-in-retail.html#cb191-1" tabindex="-1"></a><span class="fu">library</span>(colorspace)</span>
<span id="cb191-2"><a href="metrics-and-kpis-in-retail.html#cb191-2" tabindex="-1"></a>bar_chart <span class="sc">+</span> <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">fill =</span> Freq)) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Genre&quot;</span>,</span>
<span id="cb191-3"><a href="metrics-and-kpis-in-retail.html#cb191-3" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Relative frequency&quot;</span>, <span class="at">title =</span> <span class="st">&quot;Chart share by genre&quot;</span>) <span class="sc">+</span></span>
<span id="cb191-4"><a href="metrics-and-kpis-in-retail.html#cb191-4" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">sprintf</span>(<span class="st">&quot;%.1f%%&quot;</span>, Freq<span class="sc">/</span><span class="fu">sum</span>(Freq) <span class="sc">*</span></span>
<span id="cb191-5"><a href="metrics-and-kpis-in-retail.html#cb191-5" tabindex="-1"></a>        <span class="dv">100</span>)), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.2</span>) <span class="sc">+</span> <span class="fu">theme_minimal</span>() <span class="sc">+</span> <span class="fu">ylim</span>(<span class="dv">0</span>,</span>
<span id="cb191-6"><a href="metrics-and-kpis-in-retail.html#cb191-6" tabindex="-1"></a>    <span class="fl">0.5</span>) <span class="sc">+</span> <span class="fu">scale_fill_continuous_sequential</span>(<span class="at">palette =</span> <span class="st">&quot;Blues&quot;</span>) <span class="sc">+</span></span>
<span id="cb191-7"><a href="metrics-and-kpis-in-retail.html#cb191-7" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">vjust =</span> <span class="fl">0.75</span>),</span>
<span id="cb191-8"><a href="metrics-and-kpis-in-retail.html#cb191-8" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">&quot;#666666&quot;</span>),</span>
<span id="cb191-9"><a href="metrics-and-kpis-in-retail.html#cb191-9" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-14"></span>
<img src="06-retail_metrics_files/figure-html/unnamed-chunk-14-1.png" alt="Bar chart (options 1)" width="672" />
<p class="caption">
Figure 1.12: Bar chart (options 1)
</p>
</div>
<p>Finally, we can reorder the bars by size using <code>fct_reorder</code>. The first argument to the function is the <code>factor</code> we want to reorder (genre) and the second the variable by which we want to order it (frequency):</p>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb192-1"><a href="metrics-and-kpis-in-retail.html#cb192-1" tabindex="-1"></a>bar_chart <span class="sc">+</span> <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">fct_reorder</span>(Genre, Freq),</span>
<span id="cb192-2"><a href="metrics-and-kpis-in-retail.html#cb192-2" tabindex="-1"></a>    <span class="at">fill =</span> Freq)) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Genre&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Relative frequency&quot;</span>,</span>
<span id="cb192-3"><a href="metrics-and-kpis-in-retail.html#cb192-3" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Chart share by genre&quot;</span>) <span class="sc">+</span> <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">sprintf</span>(<span class="st">&quot;%.1f%%&quot;</span>,</span>
<span id="cb192-4"><a href="metrics-and-kpis-in-retail.html#cb192-4" tabindex="-1"></a>    Freq<span class="sc">/</span><span class="fu">sum</span>(Freq) <span class="sc">*</span> <span class="dv">100</span>)), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.2</span>) <span class="sc">+</span> <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb192-5"><a href="metrics-and-kpis-in-retail.html#cb192-5" tabindex="-1"></a>    <span class="fu">ylim</span>(<span class="dv">0</span>, <span class="fl">0.5</span>) <span class="sc">+</span> <span class="fu">scale_fill_continuous_sequential</span>(<span class="at">palette =</span> <span class="st">&quot;Blues&quot;</span>) <span class="sc">+</span></span>
<span id="cb192-6"><a href="metrics-and-kpis-in-retail.html#cb192-6" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">vjust =</span> <span class="fl">0.75</span>),</span>
<span id="cb192-7"><a href="metrics-and-kpis-in-retail.html#cb192-7" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">&quot;#666666&quot;</span>),</span>
<span id="cb192-8"><a href="metrics-and-kpis-in-retail.html#cb192-8" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="06-retail_metrics_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
<p>The default theme in <code>ggplot</code> is <code>theme_classic()</code>. For even more options, check out the <code>ggthemes</code> package, which includes formats for specific publications. You can check out the different themes <a href="https://cran.r-project.org/web/packages/ggthemes/vignettes/ggthemes.html" target="_blank">here</a>. For example <code>theme_economist()</code> uses the formatting of the journal “The Economist”:</p>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb193-1"><a href="metrics-and-kpis-in-retail.html#cb193-1" tabindex="-1"></a><span class="fu">library</span>(ggthemes)</span>
<span id="cb193-2"><a href="metrics-and-kpis-in-retail.html#cb193-2" tabindex="-1"></a>bar_chart <span class="sc">+</span> <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">fct_reorder</span>(Genre, Freq))) <span class="sc">+</span></span>
<span id="cb193-3"><a href="metrics-and-kpis-in-retail.html#cb193-3" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Genre&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Relative frequency&quot;</span>, <span class="at">title =</span> <span class="st">&quot;Chart songs by genre&quot;</span>) <span class="sc">+</span></span>
<span id="cb193-4"><a href="metrics-and-kpis-in-retail.html#cb193-4" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">sprintf</span>(<span class="st">&quot;%.1f%%&quot;</span>, Freq<span class="sc">/</span><span class="fu">sum</span>(Freq) <span class="sc">*</span></span>
<span id="cb193-5"><a href="metrics-and-kpis-in-retail.html#cb193-5" tabindex="-1"></a>        <span class="dv">100</span>)), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.2</span>) <span class="sc">+</span> <span class="fu">theme_economist</span>() <span class="sc">+</span></span>
<span id="cb193-6"><a href="metrics-and-kpis-in-retail.html#cb193-6" tabindex="-1"></a>    <span class="fu">ylim</span>(<span class="dv">0</span>, <span class="fl">0.5</span>) <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>,</span>
<span id="cb193-7"><a href="metrics-and-kpis-in-retail.html#cb193-7" tabindex="-1"></a>    <span class="at">vjust =</span> <span class="fl">0.55</span>), <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>,</span>
<span id="cb193-8"><a href="metrics-and-kpis-in-retail.html#cb193-8" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;#666666&quot;</span>))</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-16"></span>
<img src="06-retail_metrics_files/figure-html/unnamed-chunk-16-1.png" alt="Bar chart (options 2)" width="672" />
<p class="caption">
Figure 5.2: Bar chart (options 2)
</p>
</div>
<div class="infobox_orange hint">
<p>There are various similar packages with pre-specified themes, like the <a href="https://github.com/cttobin/ggthemr" target="_blank"><code>ggthemr</code></a> package, the <a href="https://github.com/ricardo-bion/ggtech" target="_blank"><code>ggtech</code></a> package, the <a href="https://github.com/johnmackintosh/rockthemes" target="_blank"><code>rockthemes</code></a> package, or the <a href="https://github.com/Ryo-N7/tvthemes" target="_blank"><code>tvthemes</code></a> package.</p>
</div>
<p>In a next step, we might want to investigate whether the relative frequencies differ between songs with explicit and song without explicit lyrics. For this purpose we first construct the conditional relative frequency table from the previous chapter again. Recall that the latter gives us the relative frequency within a group (in our case genres), as compared to the relative frequency within the entire sample.</p>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb194-1"><a href="metrics-and-kpis-in-retail.html#cb194-1" tabindex="-1"></a>table_plot_cond_rel <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">prop.table</span>(<span class="fu">table</span>(<span class="fu">select</span>(music_data,</span>
<span id="cb194-2"><a href="metrics-and-kpis-in-retail.html#cb194-2" tabindex="-1"></a>    genre, explicit)), <span class="dv">2</span>))  <span class="co">#conditional relative frequencies</span></span>
<span id="cb194-3"><a href="metrics-and-kpis-in-retail.html#cb194-3" tabindex="-1"></a>table_plot_cond_rel</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["genre"],"name":[1],"type":["fct"],"align":["left"]},{"label":["explicit"],"name":[2],"type":["fct"],"align":["left"]},{"label":["Freq"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"Classics/Jazz","2":"not explicit","3":"0.001126222"},{"1":"Country","2":"not explicit","3":"0.008429603"},{"1":"Electro/Dance","2":"not explicit","3":"0.030442128"},{"1":"German Folk","2":"not explicit","3":"0.006450182"},{"1":"HipHop/Rap","2":"not explicit","3":"0.341996144"},{"1":"other","2":"not explicit","3":"0.082265413"},{"1":"Pop","2":"not explicit","3":"0.433424910"},{"1":"R&B","2":"not explicit","3":"0.029605993"},{"1":"Reggae","2":"not explicit","3":"0.001877037"},{"1":"Rock","2":"not explicit","3":"0.059553265"},{"1":"Soundtrack","2":"not explicit","3":"0.004829104"},{"1":"Classics/Jazz","2":"explicit","3":"0.001708776"},{"1":"Country","2":"explicit","3":"0.001220554"},{"1":"Electro/Dance","2":"explicit","3":"0.112168925"},{"1":"German Folk","2":"explicit","3":"0.019650922"},{"1":"HipHop/Rap","2":"explicit","3":"0.132918345"},{"1":"other","2":"explicit","3":"0.049676553"},{"1":"Pop","2":"explicit","3":"0.569876724"},{"1":"R&B","2":"explicit","3":"0.017820090"},{"1":"Reggae","2":"explicit","3":"0.001342610"},{"1":"Rock","2":"explicit","3":"0.088368119"},{"1":"Soundtrack","2":"explicit","3":"0.005248383"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>We can now take these tables to construct plots grouped by explicitness. To achieve this we simply need to add the <code>facet_wrap()</code> function, which replicates a plot multiple times, split by a specified grouping factor. Note that the grouping factor has to be supplied in R’s formula notation, hence it is preceded by a “~” symbol.</p>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="metrics-and-kpis-in-retail.html#cb195-1" tabindex="-1"></a><span class="fu">ggplot</span>(table_plot_cond_rel, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">fct_reorder</span>(genre,</span>
<span id="cb195-2"><a href="metrics-and-kpis-in-retail.html#cb195-2" tabindex="-1"></a>    Freq), <span class="at">y =</span> Freq)) <span class="sc">+</span> <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">fill =</span> Freq)) <span class="sc">+</span></span>
<span id="cb195-3"><a href="metrics-and-kpis-in-retail.html#cb195-3" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>explicit) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Relative frequency&quot;</span>,</span>
<span id="cb195-4"><a href="metrics-and-kpis-in-retail.html#cb195-4" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Distribution of genres for explicit and non-explicit songs&quot;</span>) <span class="sc">+</span></span>
<span id="cb195-5"><a href="metrics-and-kpis-in-retail.html#cb195-5" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">sprintf</span>(<span class="st">&quot;%.0f%%&quot;</span>, Freq <span class="sc">*</span></span>
<span id="cb195-6"><a href="metrics-and-kpis-in-retail.html#cb195-6" tabindex="-1"></a>        <span class="dv">100</span>)), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.2</span>) <span class="sc">+</span> <span class="fu">theme_minimal</span>() <span class="sc">+</span> <span class="fu">ylim</span>(<span class="dv">0</span>,</span>
<span id="cb195-7"><a href="metrics-and-kpis-in-retail.html#cb195-7" tabindex="-1"></a>    <span class="dv">1</span>) <span class="sc">+</span> <span class="fu">scale_fill_continuous_sequential</span>(<span class="at">palette =</span> <span class="st">&quot;Blues&quot;</span>) <span class="sc">+</span></span>
<span id="cb195-8"><a href="metrics-and-kpis-in-retail.html#cb195-8" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">vjust =</span> <span class="fl">1.1</span>,</span>
<span id="cb195-9"><a href="metrics-and-kpis-in-retail.html#cb195-9" tabindex="-1"></a>        <span class="at">hjust =</span> <span class="dv">1</span>), <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>,</span>
<span id="cb195-10"><a href="metrics-and-kpis-in-retail.html#cb195-10" tabindex="-1"></a>        <span class="at">color =</span> <span class="st">&quot;#666666&quot;</span>), <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-18"></span>
<img src="06-retail_metrics_files/figure-html/unnamed-chunk-18-1.png" alt="Grouped bar chart (facet_wrap)" width="672" />
<p class="caption">
Figure 1.15: Grouped bar chart (facet_wrap)
</p>
</div>
<p>Alternatively, we might be interested to investigate the relative frequencies of explicit and non-explicit lyrics for each genre. To achieve this, we can also use the fill argument, which tells ggplot to fill the bars by a specified variable (in our case “explicit”). The position = “dodge” argument causes the bars to be displayed next to each other (as opposed to stacked on top of one another).</p>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb196-1"><a href="metrics-and-kpis-in-retail.html#cb196-1" tabindex="-1"></a>table_plot_cond_rel_1 <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">prop.table</span>(<span class="fu">table</span>(<span class="fu">select</span>(music_data, genre, explicit)),<span class="dv">1</span>)) <span class="co">#conditional relative frequencies</span></span>
<span id="cb196-2"><a href="metrics-and-kpis-in-retail.html#cb196-2" tabindex="-1"></a><span class="fu">ggplot</span>(table_plot_cond_rel_1, <span class="fu">aes</span>(<span class="at">x =</span> genre, <span class="at">y =</span> Freq, <span class="at">fill =</span> explicit)) <span class="sc">+</span> <span class="co">#use &quot;fill&quot; argument for different colors</span></span>
<span id="cb196-3"><a href="metrics-and-kpis-in-retail.html#cb196-3" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">&quot;dodge&quot;</span>) <span class="sc">+</span> <span class="co">#use &quot;dodge&quot; to display bars next to each other (instead of stacked on top)</span></span>
<span id="cb196-4"><a href="metrics-and-kpis-in-retail.html#cb196-4" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">sprintf</span>(<span class="st">&quot;%.0f%%&quot;</span>, Freq <span class="sc">*</span> <span class="dv">100</span>)),<span class="at">position=</span><span class="fu">position_dodge</span>(<span class="at">width=</span><span class="fl">0.9</span>), <span class="at">vjust=</span><span class="sc">-</span><span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb196-5"><a href="metrics-and-kpis-in-retail.html#cb196-5" tabindex="-1"></a>    <span class="fu">scale_fill_discrete_qualitative</span>(<span class="at">palette =</span> <span class="st">&quot;Dynamic&quot;</span>) <span class="sc">+</span></span>
<span id="cb196-6"><a href="metrics-and-kpis-in-retail.html#cb196-6" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Genre&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Relative frequency&quot;</span>, <span class="at">title =</span> <span class="st">&quot;Explicit lyrics share by genre&quot;</span>) <span class="sc">+</span> </span>
<span id="cb196-7"><a href="metrics-and-kpis-in-retail.html#cb196-7" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb196-8"><a href="metrics-and-kpis-in-retail.html#cb196-8" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle=</span><span class="dv">45</span>,<span class="at">vjust=</span><span class="fl">1.1</span>,<span class="at">hjust=</span><span class="dv">1</span>),</span>
<span id="cb196-9"><a href="metrics-and-kpis-in-retail.html#cb196-9" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>,<span class="at">color =</span> <span class="st">&quot;#666666&quot;</span>),</span>
<span id="cb196-10"><a href="metrics-and-kpis-in-retail.html#cb196-10" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb196-11"><a href="metrics-and-kpis-in-retail.html#cb196-11" tabindex="-1"></a>        ) </span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-19"></span>
<img src="06-retail_metrics_files/figure-html/unnamed-chunk-19-1.png" alt="Grouped bar chart (fill)" width="672" />
<p class="caption">
Figure 1.16: Grouped bar chart (fill)
</p>
</div>
</div>
</div>
<div id="continuous-variables-2" class="section level3 hasAnchor" number="5.0.7">
<h3><span class="header-section-number">5.0.7</span> Continuous variables<a href="metrics-and-kpis-in-retail.html#continuous-variables-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<br>
<div align="center">
<iframe width="560" height="315" src="https://www.youtube-nocookie.com/embed/WuMp80qZGc4" frameborder="0" allowfullscreen>
</iframe>
</div>
<p><br></p>
<div id="histogram-1" class="section level4 hasAnchor" number="5.0.7.1">
<h4><span class="header-section-number">5.0.7.1</span> Histogram<a href="metrics-and-kpis-in-retail.html#histogram-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Histograms can be created for continuous data using the <code>geom_histogram()</code> function. Note that the <code>aes()</code> function only needs one argument here, since a histogram is a plot of the distribution of only one variable. As an example, let’s consider our data set containing the music data:</p>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb197-1"><a href="metrics-and-kpis-in-retail.html#cb197-1" tabindex="-1"></a><span class="fu">head</span>(music_data)</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["isrc"],"name":[1],"type":["chr"],"align":["left"]},{"label":["artist_id"],"name":[2],"type":["int"],"align":["right"]},{"label":["streams"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["weeks_in_charts"],"name":[4],"type":["int"],"align":["right"]},{"label":["n_regions"],"name":[5],"type":["int"],"align":["right"]},{"label":["danceability"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["energy"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["speechiness"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["instrumentalness"],"name":[9],"type":["dbl"],"align":["right"]},{"label":["liveness"],"name":[10],"type":["dbl"],"align":["right"]},{"label":["valence"],"name":[11],"type":["dbl"],"align":["right"]},{"label":["tempo"],"name":[12],"type":["dbl"],"align":["right"]},{"label":["song_length"],"name":[13],"type":["dbl"],"align":["right"]},{"label":["song_age"],"name":[14],"type":["dbl"],"align":["right"]},{"label":["explicit"],"name":[15],"type":["fct"],"align":["left"]},{"label":["n_playlists"],"name":[16],"type":["int"],"align":["right"]},{"label":["sp_popularity"],"name":[17],"type":["int"],"align":["right"]},{"label":["youtube_views"],"name":[18],"type":["dbl"],"align":["right"]},{"label":["tiktok_counts"],"name":[19],"type":["int"],"align":["right"]},{"label":["ins_followers_artist"],"name":[20],"type":["int"],"align":["right"]},{"label":["monthly_listeners_artist"],"name":[21],"type":["int"],"align":["right"]},{"label":["playlist_total_reach_artist"],"name":[22],"type":["int"],"align":["right"]},{"label":["sp_fans_artist"],"name":[23],"type":["int"],"align":["right"]},{"label":["shazam_counts"],"name":[24],"type":["int"],"align":["right"]},{"label":["artistName"],"name":[25],"type":["chr"],"align":["left"]},{"label":["trackName"],"name":[26],"type":["chr"],"align":["left"]},{"label":["release_date"],"name":[27],"type":["date"],"align":["right"]},{"label":["genre"],"name":[28],"type":["fct"],"align":["left"]},{"label":["label"],"name":[29],"type":["fct"],"align":["left"]},{"label":["top10"],"name":[30],"type":["lgl"],"align":["right"]},{"label":["expert_rating"],"name":[31],"type":["ord"],"align":["right"]}],"data":[{"1":"BRRGE1603547","2":"3679","3":"11944813","4":"141","5":"1","6":"50.9","7":"80.3","8":"4.00","9":"0.050000","10":"46.30","11":"65.1","12":"166.018","13":"3.118650","14":"228.28571","15":"not explicit","16":"450","17":"51","18":"145030723","19":"9740","20":"29613108","21":"4133393","22":"24286416","23":"3308630","24":"73100","25":"Luan Santana","26":"Eu, Você, O Mar e Ela","27":"2016-06-20","28":"other","29":"Independent","30":"TRUE","31":"excellent"},{"1":"USUM71808193","2":"5239","3":"8934097","4":"51","5":"21","6":"35.3","7":"75.5","8":"73.30","9":"0.000000","10":"39.00","11":"43.7","12":"191.153","13":"3.228000","14":"144.28571","15":"not explicit","16":"768","17":"54","18":"13188411","19":"358700","20":"3693566","21":"18367363","22":"143384531","23":"465412","24":"588550","25":"Alessia Cara","26":"Growing Pains","27":"2018-06-14","28":"Pop","29":"Universal Music","30":"FALSE","31":"good"},{"1":"ES5701800181","2":"776407","3":"38835","4":"1","5":"1","6":"68.3","7":"67.6","8":"14.70","9":"0.000000","10":"7.26","11":"43.4","12":"98.992","13":"3.015550","14":"112.28571","15":"not explicit","16":"48","17":"32","18":"6116639","19":"0","20":"623778","21":"888273","22":"4846378","23":"23846","24":"0","25":"Ana Guerra","26":"El Remedio","27":"2018-04-26","28":"Pop","29":"Universal Music","30":"FALSE","31":"good"},{"1":"ITRSE2000050","2":"433730","3":"46766","4":"1","5":"1","6":"70.4","7":"56.8","8":"26.80","9":"0.000253","10":"8.91","11":"49.5","12":"91.007","13":"3.453417","14":"50.71429","15":"not explicit","16":"6","17":"44","18":"0","19":"13","20":"81601","21":"143761","22":"156521","23":"1294","24":"0","25":"Claver Gold feat. Murubutu","26":"Ulisse","27":"2020-03-31","28":"HipHop/Rap","29":"Independent","30":"FALSE","31":"poor"},{"1":"QZJ842000061","2":"526471","3":"2930573","4":"7","5":"4","6":"84.2","7":"57.8","8":"13.80","9":"0.000000","10":"22.80","11":"19.0","12":"74.496","13":"3.946317","14":"58.28571","15":"not explicit","16":"475","17":"52","18":"0","19":"515","20":"11962358","21":"15551876","22":"90841884","23":"380204","24":"55482","25":"Trippie Redd feat. Young Thug","26":"YELL OH","27":"2020-02-07","28":"HipHop/Rap","29":"Universal Music","30":"FALSE","31":"excellent"},{"1":"USIR20400274","2":"1939","3":"72199738","4":"226","5":"8","6":"35.2","7":"91.1","8":"7.47","9":"0.000000","10":"9.95","11":"23.6","12":"148.033","13":"3.716217","14":"876.71429","15":"not explicit","16":"20591","17":"81","18":"20216069","19":"67300","20":"1169284","21":"16224250","22":"80408253","23":"1651866","24":"5281161","25":"The Killers","26":"Mr. Brightside","27":"2004-06-07","28":"Rock","29":"Universal Music","30":"TRUE","31":"fair"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Now we can create the histogram using <code>geom_histogram()</code>. The argument <code>binwidth</code> specifies the range that each bar spans, <code>col = "black"</code> specifies the border to be black and <code>fill = "darkblue"</code> sets the inner color of the bars to dark blue. For brevity, we have now also started naming the x and y axis with the single function <code>labs()</code>, instead of using the two distinct functions <code>xlab()</code> and <code>ylab()</code>. Let’s look at the distribution of streams of R&amp;B songs:</p>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="metrics-and-kpis-in-retail.html#cb198-1" tabindex="-1"></a>music_data <span class="sc">|&gt;</span></span>
<span id="cb198-2"><a href="metrics-and-kpis-in-retail.html#cb198-2" tabindex="-1"></a>    <span class="fu">filter</span>(genre <span class="sc">==</span> <span class="st">&quot;R&amp;B&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb198-3"><a href="metrics-and-kpis-in-retail.html#cb198-3" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(streams)) <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">20000000</span>,</span>
<span id="cb198-4"><a href="metrics-and-kpis-in-retail.html#cb198-4" tabindex="-1"></a>    <span class="at">col =</span> <span class="st">&quot;black&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;darkblue&quot;</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Number of streams&quot;</span>,</span>
<span id="cb198-5"><a href="metrics-and-kpis-in-retail.html#cb198-5" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Frequency&quot;</span>, <span class="at">title =</span> <span class="st">&quot;Distribution of streams&quot;</span>) <span class="sc">+</span></span>
<span id="cb198-6"><a href="metrics-and-kpis-in-retail.html#cb198-6" tabindex="-1"></a>    <span class="fu">theme_bw</span>()</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-21"></span>
<img src="06-retail_metrics_files/figure-html/unnamed-chunk-21-1.png" alt="Histogram" width="672" />
<p class="caption">
Figure 1.18: Histogram
</p>
</div>
<p>If you would like to highlight certain points of the distribution, you can use the <code>geom_vline</code> (short for vertical line) function to do this. For example, we may want to highlight the mean and the median of the distribution.</p>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="metrics-and-kpis-in-retail.html#cb199-1" tabindex="-1"></a>music_data <span class="sc">|&gt;</span></span>
<span id="cb199-2"><a href="metrics-and-kpis-in-retail.html#cb199-2" tabindex="-1"></a>    <span class="fu">filter</span>(genre <span class="sc">==</span> <span class="st">&quot;R&amp;B&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb199-3"><a href="metrics-and-kpis-in-retail.html#cb199-3" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(streams)) <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">20000000</span>,</span>
<span id="cb199-4"><a href="metrics-and-kpis-in-retail.html#cb199-4" tabindex="-1"></a>    <span class="at">col =</span> <span class="st">&quot;black&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;darkblue&quot;</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Number of streams&quot;</span>,</span>
<span id="cb199-5"><a href="metrics-and-kpis-in-retail.html#cb199-5" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Frequency&quot;</span>, <span class="at">title =</span> <span class="st">&quot;Distribution of streams&quot;</span>,</span>
<span id="cb199-6"><a href="metrics-and-kpis-in-retail.html#cb199-6" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;Red vertical line = mean, green vertical line = median&quot;</span>) <span class="sc">+</span></span>
<span id="cb199-7"><a href="metrics-and-kpis-in-retail.html#cb199-7" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept =</span> <span class="fu">mean</span>(streams)), <span class="at">color =</span> <span class="st">&quot;red&quot;</span>,</span>
<span id="cb199-8"><a href="metrics-and-kpis-in-retail.html#cb199-8" tabindex="-1"></a>        <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept =</span> <span class="fu">median</span>(streams)),</span>
<span id="cb199-9"><a href="metrics-and-kpis-in-retail.html#cb199-9" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;green&quot;</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>()</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-22"></span>
<img src="06-retail_metrics_files/figure-html/unnamed-chunk-22-1.png" alt="Histogram 2" width="672" />
<p class="caption">
Figure 1.19: Histogram 2
</p>
</div>
<p>In this case, you should indicate what the lines refer to. In the plot above, the ‘subtitle’ argument was used to add this information to the plot.</p>
<div class="infobox_orange hint">
<p>Note the difference between a bar chart and the histogram. While a bar chart is used to visualize the frequency of observations for categorical variables, the histogram shows the frequency distribution for continuous variables.</p>
</div>
</div>
<div id="boxplot-1" class="section level4 hasAnchor" number="5.0.7.2">
<h4><span class="header-section-number">5.0.7.2</span> Boxplot<a href="metrics-and-kpis-in-retail.html#boxplot-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Another common way to display the distribution of continuous variables is through boxplots. ggplot will construct a boxplot if given the geom <code>geom_boxplot()</code>. In our case we might want to show the difference in streams between the genres. For this analysis, we will transform the streaming variable using a logarithmic transformation, which is common with such data (as we will see later). So let’s first create a new variable by taking the logarithm of the streams variable.</p>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb200-1"><a href="metrics-and-kpis-in-retail.html#cb200-1" tabindex="-1"></a>music_data<span class="sc">$</span>log_streams <span class="ot">&lt;-</span> <span class="fu">log</span>(music_data<span class="sc">$</span>streams)</span></code></pre></div>
<p>Now, let’s create a boxplot based on these variables and plot the log-transformed number of streams by genre.</p>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="metrics-and-kpis-in-retail.html#cb201-1" tabindex="-1"></a><span class="fu">ggplot</span>(music_data, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">fct_reorder</span>(genre, log_streams),</span>
<span id="cb201-2"><a href="metrics-and-kpis-in-retail.html#cb201-2" tabindex="-1"></a>    <span class="at">y =</span> log_streams)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>(<span class="at">coef =</span> <span class="dv">3</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Genre&quot;</span>,</span>
<span id="cb201-3"><a href="metrics-and-kpis-in-retail.html#cb201-3" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Number of streams (log-scale)&quot;</span>) <span class="sc">+</span> <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb201-4"><a href="metrics-and-kpis-in-retail.html#cb201-4" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">vjust =</span> <span class="fl">1.1</span>,</span>
<span id="cb201-5"><a href="metrics-and-kpis-in-retail.html#cb201-5" tabindex="-1"></a>        <span class="at">hjust =</span> <span class="dv">1</span>), <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>,</span>
<span id="cb201-6"><a href="metrics-and-kpis-in-retail.html#cb201-6" tabindex="-1"></a>        <span class="at">color =</span> <span class="st">&quot;#666666&quot;</span>), <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-24"></span>
<img src="06-retail_metrics_files/figure-html/unnamed-chunk-24-1.png" alt="Boxplot by group" width="672" />
<p class="caption">
Figure 1.21: Boxplot by group
</p>
</div>
<p>The following graphic shows you how to interpret the boxplot:</p>
<div class="float">
<img src="https://github.com/IMSMWU/Teaching/raw/master/MRDA2017/boxplot.JPG" alt="Information contained in a Boxplot" />
<div class="figcaption">Information contained in a Boxplot</div>
</div>
<p>Note that you could also flip the boxplot. To do this, you only need to exchange the x- and y-variables. If we provide the categorical variable to the y-axis as follows, the axis will be flipped.</p>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="metrics-and-kpis-in-retail.html#cb202-1" tabindex="-1"></a><span class="fu">ggplot</span>(music_data, <span class="fu">aes</span>(<span class="at">x =</span> log_streams, <span class="at">y =</span> <span class="fu">fct_reorder</span>(genre,</span>
<span id="cb202-2"><a href="metrics-and-kpis-in-retail.html#cb202-2" tabindex="-1"></a>    log_streams))) <span class="sc">+</span> <span class="fu">geom_boxplot</span>(<span class="at">coef =</span> <span class="dv">3</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Number of streams (log-scale)&quot;</span>,</span>
<span id="cb202-3"><a href="metrics-and-kpis-in-retail.html#cb202-3" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Genre&quot;</span>) <span class="sc">+</span> <span class="fu">theme_minimal</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>,</span>
<span id="cb202-4"><a href="metrics-and-kpis-in-retail.html#cb202-4" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;#666666&quot;</span>), <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-25"></span>
<img src="06-retail_metrics_files/figure-html/unnamed-chunk-25-1.png" alt="Boxplot by group" width="672" />
<p class="caption">
Figure 1.22: Boxplot by group
</p>
</div>
<p>It is often meaningful to augment the boxplot with the data points using <code>geom_jitter()</code>. This way, differences in the distribution of the variable between the genres become even more apparent.</p>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="metrics-and-kpis-in-retail.html#cb203-1" tabindex="-1"></a><span class="fu">ggplot</span>(music_data, <span class="fu">aes</span>(<span class="at">x =</span> log_streams, <span class="at">y =</span> <span class="fu">fct_reorder</span>(genre,</span>
<span id="cb203-2"><a href="metrics-and-kpis-in-retail.html#cb203-2" tabindex="-1"></a>    log_streams))) <span class="sc">+</span> <span class="fu">geom_jitter</span>(<span class="at">colour =</span> <span class="st">&quot;red&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb203-3"><a href="metrics-and-kpis-in-retail.html#cb203-3" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>(<span class="at">coef =</span> <span class="dv">3</span>, <span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Number of streams (log-scale)&quot;</span>,</span>
<span id="cb203-4"><a href="metrics-and-kpis-in-retail.html#cb203-4" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Genre&quot;</span>) <span class="sc">+</span> <span class="fu">theme_minimal</span>()</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-26"></span>
<img src="06-retail_metrics_files/figure-html/unnamed-chunk-26-1.png" alt="Boxplot by group" width="672" />
<p class="caption">
Figure 1.23: Boxplot by group
</p>
</div>
<p>In case you would like to create the boxplot on the total data (i.e., not by group), just leave the <code>y =</code> argument within the <code>aes()</code> function empty:</p>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="metrics-and-kpis-in-retail.html#cb204-1" tabindex="-1"></a><span class="fu">ggplot</span>(music_data, <span class="fu">aes</span>(<span class="at">x =</span> log_streams, <span class="at">y =</span> <span class="st">&quot;&quot;</span>)) <span class="sc">+</span></span>
<span id="cb204-2"><a href="metrics-and-kpis-in-retail.html#cb204-2" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>(<span class="at">coef =</span> <span class="dv">3</span>, <span class="at">width =</span> <span class="fl">0.3</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Number of streams (log-scale)&quot;</span>,</span>
<span id="cb204-3"><a href="metrics-and-kpis-in-retail.html#cb204-3" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-27"></span>
<img src="06-retail_metrics_files/figure-html/unnamed-chunk-27-1.png" alt="Single Boxplot" width="672" />
<p class="caption">
Figure 1.24: Single Boxplot
</p>
</div>
</div>
<div id="plot-of-means-1" class="section level4 hasAnchor" number="5.0.7.3">
<h4><span class="header-section-number">5.0.7.3</span> Plot of means<a href="metrics-and-kpis-in-retail.html#plot-of-means-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Another way to get an overview of the difference between two groups is to plot their respective means with confidence intervals. The mean and confidence intervals will enter the plot separately, using the geoms <code>geom_bar()</code> and <code>geom_errorbar()</code>. Don’t worry if you don’t know exactly how to interpret the confidence interval at this stage - we will cover this topic in the next chapter. Let’s assume we would like to plot the difference in streams between the HipHop &amp; Rap genre and all other genres. For this, we first need to create a dummy variable (i.e., a categorical variable with two levels) that indicates if a song is from the HipHop &amp; Rap genre or from any of the other genres. We can use the <code>ifelse()</code> function to do this, which takes 3 arguments, namely 1) the if-statement, 2) the returned value if this if-statement is true, and 3) the value if the if-statement is not true.</p>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="metrics-and-kpis-in-retail.html#cb205-1" tabindex="-1"></a>music_data<span class="sc">$</span>genre_dummy <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">ifelse</span>(music_data<span class="sc">$</span>genre <span class="sc">==</span></span>
<span id="cb205-2"><a href="metrics-and-kpis-in-retail.html#cb205-2" tabindex="-1"></a>    <span class="st">&quot;HipHop/Rap&quot;</span>, <span class="st">&quot;HipHop &amp; Rap&quot;</span>, <span class="st">&quot;other&quot;</span>))</span></code></pre></div>
<p>To make plotting the desired comparison easier, we can compute all relevant statistics first, using the <code>summarySE()</code> function from the <code>Rmisc</code> package.</p>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb206-1"><a href="metrics-and-kpis-in-retail.html#cb206-1" tabindex="-1"></a><span class="fu">library</span>(Rmisc)</span>
<span id="cb206-2"><a href="metrics-and-kpis-in-retail.html#cb206-2" tabindex="-1"></a>mean_data <span class="ot">&lt;-</span> <span class="fu">summarySE</span>(music_data, <span class="at">measurevar =</span> <span class="st">&quot;streams&quot;</span>,</span>
<span id="cb206-3"><a href="metrics-and-kpis-in-retail.html#cb206-3" tabindex="-1"></a>    <span class="at">groupvars =</span> <span class="fu">c</span>(<span class="st">&quot;genre_dummy&quot;</span>))</span>
<span id="cb206-4"><a href="metrics-and-kpis-in-retail.html#cb206-4" tabindex="-1"></a>mean_data</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["genre_dummy"],"name":[1],"type":["fct"],"align":["left"]},{"label":["N"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["streams"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["sd"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["se"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["ci"],"name":[6],"type":["dbl"],"align":["right"]}],"data":[{"1":"HipHop & Rap","2":"21131","3":"6772815","4":"37100201","5":"255220.9","6":"500252.4"},{"1":"other","2":"45665","3":"7565413","4":"41208925","5":"192841.1","6":"377971.6"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>The output tells you how many observations there are per group, the mean number of streams per group, as well as the group-specific standard deviation, the standard error, and the confidence interval (more on this in the next chapter). You can now create the plot as follows:</p>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="metrics-and-kpis-in-retail.html#cb207-1" tabindex="-1"></a><span class="fu">ggplot</span>(mean_data, <span class="fu">aes</span>(<span class="at">x =</span> genre_dummy, <span class="at">y =</span> streams)) <span class="sc">+</span></span>
<span id="cb207-2"><a href="metrics-and-kpis-in-retail.html#cb207-2" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="fl">0.9</span>), <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb207-3"><a href="metrics-and-kpis-in-retail.html#cb207-3" tabindex="-1"></a>        <span class="at">fill =</span> <span class="st">&quot;#CCCCCC&quot;</span>, <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">width =</span> <span class="fl">0.65</span>) <span class="sc">+</span></span>
<span id="cb207-4"><a href="metrics-and-kpis-in-retail.html#cb207-4" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="fl">0.9</span>), <span class="at">width =</span> <span class="fl">0.15</span>,</span>
<span id="cb207-5"><a href="metrics-and-kpis-in-retail.html#cb207-5" tabindex="-1"></a>        <span class="fu">aes</span>(<span class="at">ymin =</span> streams <span class="sc">-</span> ci, <span class="at">ymax =</span> streams <span class="sc">+</span> ci)) <span class="sc">+</span></span>
<span id="cb207-6"><a href="metrics-and-kpis-in-retail.html#cb207-6" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Genre&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Average number of streams&quot;</span>,</span>
<span id="cb207-7"><a href="metrics-and-kpis-in-retail.html#cb207-7" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Average number of streams by genre&quot;</span>) <span class="sc">+</span></span>
<span id="cb207-8"><a href="metrics-and-kpis-in-retail.html#cb207-8" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>,</span>
<span id="cb207-9"><a href="metrics-and-kpis-in-retail.html#cb207-9" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;#666666&quot;</span>))</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-30"></span>
<img src="06-retail_metrics_files/figure-html/unnamed-chunk-30-1.png" alt="Plot of means" width="672" />
<p class="caption">
Figure 5.3: Plot of means
</p>
</div>
<p>As can be seen, there is a large difference between the genres with respect to the average number of streams.</p>
</div>
<div id="grouped-plot-of-means-1" class="section level4 hasAnchor" number="5.0.7.4">
<h4><span class="header-section-number">5.0.7.4</span> Grouped plot of means<a href="metrics-and-kpis-in-retail.html#grouped-plot-of-means-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We might also be interested to investigate a second factor. Say, we would like to find out if there is a difference between genres with respect to the lyrics (i.e., whether the lyrics are explicit or not). Can we find evidence that explicit lyrics affect streams of songs from the HipHop &amp; Rap genre differently compared to other genres. We can compute the statistics using the <code>summarySE()</code> function by simply adding the second variable to the ‘groupvars’ argument.</p>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="metrics-and-kpis-in-retail.html#cb208-1" tabindex="-1"></a>mean_data2 <span class="ot">&lt;-</span> <span class="fu">summarySE</span>(music_data, <span class="at">measurevar =</span> <span class="st">&quot;streams&quot;</span>,</span>
<span id="cb208-2"><a href="metrics-and-kpis-in-retail.html#cb208-2" tabindex="-1"></a>    <span class="at">groupvars =</span> <span class="fu">c</span>(<span class="st">&quot;genre_dummy&quot;</span>, <span class="st">&quot;explicit&quot;</span>))</span>
<span id="cb208-3"><a href="metrics-and-kpis-in-retail.html#cb208-3" tabindex="-1"></a>mean_data2</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["genre_dummy"],"name":[1],"type":["fct"],"align":["left"]},{"label":["explicit"],"name":[2],"type":["fct"],"align":["left"]},{"label":["N"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["streams"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["sd"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["se"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["ci"],"name":[7],"type":["dbl"],"align":["right"]}],"data":[{"1":"HipHop & Rap","2":"not explicit","3":"20042","4":"7009717","5":"38037891","6":"268686.5","7":"526647.7"},{"1":"HipHop & Rap","2":"explicit","3":"1089","4":"2412873","5":"7734491","6":"234378.5","7":"459885.0"},{"1":"other","2":"not explicit","3":"38561","4":"8459087","5":"44385299","6":"226029.4","7":"443023.5"},{"1":"other","2":"explicit","3":"7104","4":"2714494","5":"13949731","6":"165506.2","7":"324441.5"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Now we obtained the results for four different groups (2 genres x 2 lyric types) and we can amend the plot easily by adding the ‘fill’ argument to the <code>ggplot()</code> function. The <code>scale_fill_manual()</code> function is optional and specifies the color of the bars manually.</p>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="metrics-and-kpis-in-retail.html#cb209-1" tabindex="-1"></a><span class="fu">ggplot</span>(mean_data2, <span class="fu">aes</span>(<span class="at">x =</span> genre_dummy, <span class="at">y =</span> streams,</span>
<span id="cb209-2"><a href="metrics-and-kpis-in-retail.html#cb209-2" tabindex="-1"></a>    <span class="at">fill =</span> explicit)) <span class="sc">+</span> <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="fl">0.9</span>),</span>
<span id="cb209-3"><a href="metrics-and-kpis-in-retail.html#cb209-3" tabindex="-1"></a>    <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>, <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="sc">+</span> <span class="fu">geom_errorbar</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="fl">0.9</span>),</span>
<span id="cb209-4"><a href="metrics-and-kpis-in-retail.html#cb209-4" tabindex="-1"></a>    <span class="at">width =</span> <span class="fl">0.2</span>, <span class="fu">aes</span>(<span class="at">ymin =</span> streams <span class="sc">-</span> ci, <span class="at">ymax =</span> streams <span class="sc">+</span></span>
<span id="cb209-5"><a href="metrics-and-kpis-in-retail.html#cb209-5" tabindex="-1"></a>        ci)) <span class="sc">+</span> <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;#CCCCCC&quot;</span>,</span>
<span id="cb209-6"><a href="metrics-and-kpis-in-retail.html#cb209-6" tabindex="-1"></a>    <span class="st">&quot;#FFFFFF&quot;</span>)) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Genre&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Average number of streams&quot;</span>,</span>
<span id="cb209-7"><a href="metrics-and-kpis-in-retail.html#cb209-7" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Average number of streams by genre and lyric type&quot;</span>) <span class="sc">+</span></span>
<span id="cb209-8"><a href="metrics-and-kpis-in-retail.html#cb209-8" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>,</span>
<span id="cb209-9"><a href="metrics-and-kpis-in-retail.html#cb209-9" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;#666666&quot;</span>))</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-32"></span>
<img src="06-retail_metrics_files/figure-html/unnamed-chunk-32-1.png" alt="Grouped plot of means" width="672" />
<p class="caption">
Figure 5.4: Grouped plot of means
</p>
</div>
<p>The results of the analysis show that also in the HipHop &amp; Rap genre, songs with non-explicit lyrics obtain more streams on average, contrary to our expectations.</p>
</div>
<div id="scatter-plot-1" class="section level4 hasAnchor" number="5.0.7.5">
<h4><span class="header-section-number">5.0.7.5</span> Scatter plot<a href="metrics-and-kpis-in-retail.html#scatter-plot-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The most common way to show the relationship between two continuous variables is a scatterplot. As an example, let’s investigate if there is an association between the number of streams a song receives and the speechiness of the song. The following code creates a scatterplot with some additional components. The <code>geom_smooth()</code> function creates a smoothed line from the data provided. In this particular example we tell the function to draw the best possible straight line (i.e., minimizing the distance between the line and the points) through the data (via the argument <code>method = "lm"</code>). Note that the “shape = 1” argument passed to the <code>geom_point()</code> function produces hollow circles (instead of solid) and the “fill” and “alpha” arguments passed to the <code>geom_smooth()</code> function specify the color and the opacity of the confidence interval, respectively.</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="metrics-and-kpis-in-retail.html#cb210-1" tabindex="-1"></a><span class="fu">ggplot</span>(music_data, <span class="fu">aes</span>(speechiness, log_streams)) <span class="sc">+</span></span>
<span id="cb210-2"><a href="metrics-and-kpis-in-retail.html#cb210-2" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Genre&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Relative frequency&quot;</span>) <span class="sc">+</span></span>
<span id="cb210-3"><a href="metrics-and-kpis-in-retail.html#cb210-3" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb210-4"><a href="metrics-and-kpis-in-retail.html#cb210-4" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Speechiness&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Number of streams (log-scale)&quot;</span>,</span>
<span id="cb210-5"><a href="metrics-and-kpis-in-retail.html#cb210-5" tabindex="-1"></a>        <span class="at">title =</span> <span class="st">&quot;Scatterplot of streams and speechiness&quot;</span>) <span class="sc">+</span></span>
<span id="cb210-6"><a href="metrics-and-kpis-in-retail.html#cb210-6" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>,</span>
<span id="cb210-7"><a href="metrics-and-kpis-in-retail.html#cb210-7" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;#666666&quot;</span>))</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-33"></span>
<img src="06-retail_metrics_files/figure-html/unnamed-chunk-33-1.png" alt="Scatter plot" width="672" />
<p class="caption">
Figure 4.2: Scatter plot
</p>
</div>
<p>As you can see, there appears to be a positive relationship between advertising and sales.</p>
<div id="grouped-scatter-plot-1" class="section level5 hasAnchor" number="5.0.7.5.1">
<h5><span class="header-section-number">5.0.7.5.1</span> Grouped scatter plot<a href="metrics-and-kpis-in-retail.html#grouped-scatter-plot-1" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>It could be that customers from different store respond differently to advertising. We can visually capture such differences with a grouped scatter plot. By adding the argument <code>colour = store</code> to the aesthetic specification, ggplot automatically treats the two stores as distinct groups and plots accordingly.</p>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="metrics-and-kpis-in-retail.html#cb211-1" tabindex="-1"></a><span class="fu">ggplot</span>(music_data, <span class="fu">aes</span>(speechiness, log_streams, <span class="at">colour =</span> explicit)) <span class="sc">+</span></span>
<span id="cb211-2"><a href="metrics-and-kpis-in-retail.html#cb211-2" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>,</span>
<span id="cb211-3"><a href="metrics-and-kpis-in-retail.html#cb211-3" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Speechiness&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Number of streams (log-scale)&quot;</span>,</span>
<span id="cb211-4"><a href="metrics-and-kpis-in-retail.html#cb211-4" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Scatterplot of streams and speechiness by lyric type&quot;</span>,</span>
<span id="cb211-5"><a href="metrics-and-kpis-in-retail.html#cb211-5" tabindex="-1"></a>    <span class="at">colour =</span> <span class="st">&quot;Explicit&quot;</span>) <span class="sc">+</span> <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;lightblue&quot;</span>,</span>
<span id="cb211-6"><a href="metrics-and-kpis-in-retail.html#cb211-6" tabindex="-1"></a>    <span class="st">&quot;darkblue&quot;</span>)) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>,</span>
<span id="cb211-7"><a href="metrics-and-kpis-in-retail.html#cb211-7" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;#666666&quot;</span>))</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-34"></span>
<img src="06-retail_metrics_files/figure-html/unnamed-chunk-34-1.png" alt="Grouped scatter plot" width="672" />
<p class="caption">
Figure 4.3: Grouped scatter plot
</p>
</div>
<p>It appears from the plot that the association between speechiness and the number of streams is stronger for songs without explicit lyrics.</p>
</div>
</div>
<div id="line-plot-1" class="section level4 hasAnchor" number="5.0.7.6">
<h4><span class="header-section-number">5.0.7.6</span> Line plot<a href="metrics-and-kpis-in-retail.html#line-plot-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Another important type of plot is the line plot used if, for example, you have a variable that changes over time and you want to plot how it develops over time. To demonstrate this we will investigate a data set that show the development of the number of streams of the Top200 songs on a popular music streaming service for different region. Let’s investigate the data first and bring all variables to the correct format.</p>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="metrics-and-kpis-in-retail.html#cb212-1" tabindex="-1"></a>music_data_ctry <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;https://raw.githubusercontent.com/IMSMWU/Teaching/master/MRDA2017/streaming_charts_ctry.csv&quot;</span>,</span>
<span id="cb212-2"><a href="metrics-and-kpis-in-retail.html#cb212-2" tabindex="-1"></a>    <span class="at">sep =</span> <span class="st">&quot;,&quot;</span>, <span class="at">header =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb212-3"><a href="metrics-and-kpis-in-retail.html#cb212-3" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">week =</span> <span class="fu">as.Date</span>(week), <span class="at">region =</span> <span class="fu">as.factor</span>(region))</span>
<span id="cb212-4"><a href="metrics-and-kpis-in-retail.html#cb212-4" tabindex="-1"></a><span class="fu">head</span>(music_data_ctry)</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["week"],"name":[1],"type":["date"],"align":["right"]},{"label":["region"],"name":[2],"type":["fct"],"align":["left"]},{"label":["streams"],"name":[3],"type":["int"],"align":["right"]}],"data":[{"1":"2017-01-01","2":"ar","3":"45390029"},{"1":"2017-01-01","2":"at","3":"5111149"},{"1":"2017-01-01","2":"au","3":"46201117"},{"1":"2017-01-01","2":"be","3":"8082253"},{"1":"2017-01-01","2":"bg","3":"86293"},{"1":"2017-01-01","2":"bo","3":"1055670"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>In a first step, let’s investigate the development for Austria, by filtering the data to region ‘at’.</p>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb213-1"><a href="metrics-and-kpis-in-retail.html#cb213-1" tabindex="-1"></a>music_data_at <span class="ot">&lt;-</span> <span class="fu">filter</span>(music_data_ctry, region <span class="sc">==</span></span>
<span id="cb213-2"><a href="metrics-and-kpis-in-retail.html#cb213-2" tabindex="-1"></a>    <span class="st">&quot;at&quot;</span>)</span></code></pre></div>
<p>Given the correct <code>aes()</code> and geom specification ggplot constructs the correct plot for us. In order to make large numbers more readable we use the <code>label_comma</code> function from the <code>scales</code> package in the <code>scale_y_continuous</code> layer.</p>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="metrics-and-kpis-in-retail.html#cb214-1" tabindex="-1"></a><span class="fu">ggplot</span>(music_data_at, <span class="fu">aes</span>(<span class="at">x =</span> week, <span class="at">y =</span> streams)) <span class="sc">+</span></span>
<span id="cb214-2"><a href="metrics-and-kpis-in-retail.html#cb214-2" tabindex="-1"></a>    <span class="fu">geom_line</span>() <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Total streams in Austria&quot;</span>,</span>
<span id="cb214-3"><a href="metrics-and-kpis-in-retail.html#cb214-3" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Weekly number of streams in Austria&quot;</span>) <span class="sc">+</span></span>
<span id="cb214-4"><a href="metrics-and-kpis-in-retail.html#cb214-4" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_comma</span>()) <span class="sc">+</span></span>
<span id="cb214-5"><a href="metrics-and-kpis-in-retail.html#cb214-5" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">&quot;#666666&quot;</span>))</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-37"></span>
<img src="06-retail_metrics_files/figure-html/unnamed-chunk-37-1.png" alt="Line plot" width="672" />
<p class="caption">
Figure 5.5: Line plot
</p>
</div>
<p>There appears to be a positive trend in the market. Now let’s compare Austria to other countries. Note that the <code>%in%</code> operator checks for us if any of the region names specified in the vector are included in the region column.</p>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb215-1"><a href="metrics-and-kpis-in-retail.html#cb215-1" tabindex="-1"></a>music_data_at_compare <span class="ot">&lt;-</span> <span class="fu">filter</span>(music_data_ctry, region <span class="sc">%in%</span></span>
<span id="cb215-2"><a href="metrics-and-kpis-in-retail.html#cb215-2" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">&quot;at&quot;</span>, <span class="st">&quot;de&quot;</span>, <span class="st">&quot;ch&quot;</span>, <span class="st">&quot;se&quot;</span>, <span class="st">&quot;dk&quot;</span>, <span class="st">&quot;nl&quot;</span>))</span></code></pre></div>
<p>We can now include the other specified countries in the plot by using the ‘color’ argument.</p>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="metrics-and-kpis-in-retail.html#cb216-1" tabindex="-1"></a><span class="fu">ggplot</span>(music_data_at_compare, <span class="fu">aes</span>(<span class="at">x =</span> week, <span class="at">y =</span> streams,</span>
<span id="cb216-2"><a href="metrics-and-kpis-in-retail.html#cb216-2" tabindex="-1"></a>    <span class="at">color =</span> region)) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Week&quot;</span>,</span>
<span id="cb216-3"><a href="metrics-and-kpis-in-retail.html#cb216-3" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Total streams&quot;</span>, <span class="at">title =</span> <span class="st">&quot;Weekly number of streams by country&quot;</span>) <span class="sc">+</span></span>
<span id="cb216-4"><a href="metrics-and-kpis-in-retail.html#cb216-4" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>,</span>
<span id="cb216-5"><a href="metrics-and-kpis-in-retail.html#cb216-5" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;#666666&quot;</span>)) <span class="sc">+</span> <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_comma</span>())</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-39"></span>
<img src="06-retail_metrics_files/figure-html/unnamed-chunk-39-1.png" alt="Line plot (by region)" width="672" />
<p class="caption">
Figure 5.6: Line plot (by region)
</p>
</div>
<p>One issue in plot like this can be that the scales between countries is very different (i.e., in Germany there are many more streams because Germany is larger than the other countries). You could also use the <code>facet_wrap()</code> function to create one individual plot by region and specify ‘scales = “free_y”’ so that each individual plot has its own scale on the y-axis. We should also indicate the number of streams in millions by dividing the number of streams.</p>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb217-1"><a href="metrics-and-kpis-in-retail.html#cb217-1" tabindex="-1"></a><span class="fu">ggplot</span>(music_data_at_compare, <span class="fu">aes</span>(<span class="at">x =</span> week, <span class="at">y =</span> streams<span class="sc">/</span><span class="dv">1000000</span>)) <span class="sc">+</span></span>
<span id="cb217-2"><a href="metrics-and-kpis-in-retail.html#cb217-2" tabindex="-1"></a>    <span class="fu">geom_line</span>() <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span>region, <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>) <span class="sc">+</span></span>
<span id="cb217-3"><a href="metrics-and-kpis-in-retail.html#cb217-3" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Week&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Total streams (in million)&quot;</span>,</span>
<span id="cb217-4"><a href="metrics-and-kpis-in-retail.html#cb217-4" tabindex="-1"></a>        <span class="at">title =</span> <span class="st">&quot;Weekly number of streams by country&quot;</span>) <span class="sc">+</span></span>
<span id="cb217-5"><a href="metrics-and-kpis-in-retail.html#cb217-5" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>,</span>
<span id="cb217-6"><a href="metrics-and-kpis-in-retail.html#cb217-6" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;#666666&quot;</span>))</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-40"></span>
<img src="06-retail_metrics_files/figure-html/unnamed-chunk-40-1.png" alt="Line plot (facet wrap)" width="672" />
<p class="caption">
Figure 4.6: Line plot (facet wrap)
</p>
</div>
<p>Now it’s easier to see that the trends are different between countries. While Sweden and Denmark appear to be saturated, the other market show strong growth.</p>
</div>
<div id="area-plots-1" class="section level4 hasAnchor" number="5.0.7.7">
<h4><span class="header-section-number">5.0.7.7</span> Area plots<a href="metrics-and-kpis-in-retail.html#area-plots-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>A slightly different way to plot this data is through area plot using the <code>geom_area()</code> function.</p>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="metrics-and-kpis-in-retail.html#cb218-1" tabindex="-1"></a><span class="fu">ggplot</span>(music_data_at_compare, <span class="fu">aes</span>(<span class="at">x =</span> week, <span class="at">y =</span> streams<span class="sc">/</span><span class="dv">1000000</span>)) <span class="sc">+</span></span>
<span id="cb218-2"><a href="metrics-and-kpis-in-retail.html#cb218-2" tabindex="-1"></a>    <span class="fu">geom_area</span>(<span class="at">fill =</span> <span class="st">&quot;steelblue&quot;</span>, <span class="at">color =</span> <span class="st">&quot;steelblue&quot;</span>,</span>
<span id="cb218-3"><a href="metrics-and-kpis-in-retail.html#cb218-3" tabindex="-1"></a>        <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span>region, <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>) <span class="sc">+</span></span>
<span id="cb218-4"><a href="metrics-and-kpis-in-retail.html#cb218-4" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Week&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Total streams (in million)&quot;</span>,</span>
<span id="cb218-5"><a href="metrics-and-kpis-in-retail.html#cb218-5" tabindex="-1"></a>        <span class="at">title =</span> <span class="st">&quot;Weekly number of streams by country&quot;</span>) <span class="sc">+</span></span>
<span id="cb218-6"><a href="metrics-and-kpis-in-retail.html#cb218-6" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>,</span>
<span id="cb218-7"><a href="metrics-and-kpis-in-retail.html#cb218-7" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;#666666&quot;</span>))</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-41"></span>
<img src="06-retail_metrics_files/figure-html/unnamed-chunk-41-1.png" alt="Line plot (facet wrap)" width="672" />
<p class="caption">
Figure 4.7: Line plot (facet wrap)
</p>
</div>
<p>If the relative share of the overall streaming volume is of interest, you could use a stacked area plot to visualize this.</p>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb219-1"><a href="metrics-and-kpis-in-retail.html#cb219-1" tabindex="-1"></a><span class="fu">ggplot</span>(music_data_at_compare, <span class="fu">aes</span>(<span class="at">x =</span> week, <span class="at">y =</span> streams<span class="sc">/</span><span class="dv">1000000</span>,</span>
<span id="cb219-2"><a href="metrics-and-kpis-in-retail.html#cb219-2" tabindex="-1"></a>    <span class="at">group =</span> region, <span class="at">fill =</span> region, <span class="at">color =</span> region)) <span class="sc">+</span></span>
<span id="cb219-3"><a href="metrics-and-kpis-in-retail.html#cb219-3" tabindex="-1"></a>    <span class="fu">geom_area</span>(<span class="at">position =</span> <span class="st">&quot;stack&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.65</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Week&quot;</span>,</span>
<span id="cb219-4"><a href="metrics-and-kpis-in-retail.html#cb219-4" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Total streams (in million)&quot;</span>, <span class="at">title =</span> <span class="st">&quot;Weekly number of streams by country&quot;</span>) <span class="sc">+</span></span>
<span id="cb219-5"><a href="metrics-and-kpis-in-retail.html#cb219-5" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>,</span>
<span id="cb219-6"><a href="metrics-and-kpis-in-retail.html#cb219-6" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;#666666&quot;</span>))</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-42"></span>
<img src="06-retail_metrics_files/figure-html/unnamed-chunk-42-1.png" alt="Line plot (facet wrap)" width="672" />
<p class="caption">
Figure 4.8: Line plot (facet wrap)
</p>
</div>
<p>In this type of plot it is easy to spot the relative size of the regions.</p>
<p>In some cases it could also make sense to add a secondary y-axis, for example, if you would like to compare two regions with very different scales in one plot. Let’s assume, we would like to compare Austria and Sweden and take the corresponding subset.</p>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="metrics-and-kpis-in-retail.html#cb220-1" tabindex="-1"></a>music_data_at_se_compare <span class="ot">&lt;-</span> <span class="fu">filter</span>(music_data_ctry,</span>
<span id="cb220-2"><a href="metrics-and-kpis-in-retail.html#cb220-2" tabindex="-1"></a>    region <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;at&quot;</span>, <span class="st">&quot;se&quot;</span>))</span></code></pre></div>
<p>In order to add the secondary y-axis, we need the data in a slightly different format where we have one column for each country. This is called the ‘wide format’ as opposed to the ‘long format’ where the data is stacked on top of each other for all regions. We can easily convert the data to the wide format by using the <code>pivot_wider()</code> function from the <code>tidyr</code> package.</p>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb221-1"><a href="metrics-and-kpis-in-retail.html#cb221-1" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb221-2"><a href="metrics-and-kpis-in-retail.html#cb221-2" tabindex="-1"></a>data_wide <span class="ot">&lt;-</span> <span class="fu">pivot_wider</span>(music_data_at_se_compare,</span>
<span id="cb221-3"><a href="metrics-and-kpis-in-retail.html#cb221-3" tabindex="-1"></a>    <span class="at">names_from =</span> region, <span class="at">values_from =</span> streams)</span>
<span id="cb221-4"><a href="metrics-and-kpis-in-retail.html#cb221-4" tabindex="-1"></a>data_wide</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["week"],"name":[1],"type":["date"],"align":["right"]},{"label":["at"],"name":[2],"type":["int"],"align":["right"]},{"label":["se"],"name":[3],"type":["int"],"align":["right"]}],"data":[{"1":"2017-01-01","2":"5111149","3":"50954037"},{"1":"2017-01-08","2":"5457685","3":"57939416"},{"1":"2017-01-15","2":"5567194","3":"58641186"},{"1":"2017-01-22","2":"5710706","3":"59964443"},{"1":"2017-01-29","2":"5863767","3":"60842736"},{"1":"2017-02-05","2":"5818891","3":"60719187"},{"1":"2017-02-12","2":"5825375","3":"66030167"},{"1":"2017-02-19","2":"5980088","3":"66757766"},{"1":"2017-02-26","2":"6193209","3":"74623078"},{"1":"2017-03-05","2":"6530977","3":"78206599"},{"1":"2017-03-12","2":"6226134","3":"77844328"},{"1":"2017-03-19","2":"6224872","3":"74846520"},{"1":"2017-03-26","2":"5935317","3":"68795434"},{"1":"2017-04-02","2":"5901265","3":"64042942"},{"1":"2017-04-09","2":"5893873","3":"61359075"},{"1":"2017-04-16","2":"5593692","3":"60586098"},{"1":"2017-04-23","2":"5834484","3":"64093428"},{"1":"2017-04-30","2":"5892671","3":"69214046"},{"1":"2017-05-07","2":"5957329","3":"66993832"},{"1":"2017-05-14","2":"6319769","3":"70942864"},{"1":"2017-05-21","2":"6489634","3":"73616050"},{"1":"2017-05-28","2":"3822981","3":"38417005"},{"1":"2017-06-04","2":"6792423","3":"67314409"},{"1":"2017-06-11","2":"7074928","3":"68548091"},{"1":"2017-06-18","2":"7124538","3":"72516107"},{"1":"2017-06-25","2":"6964368","3":"67589714"},{"1":"2017-07-02","2":"6983387","3":"66675817"},{"1":"2017-07-09","2":"6888585","3":"66359870"},{"1":"2017-07-16","2":"7216108","3":"62463985"},{"1":"2017-07-23","2":"6774841","3":"59025668"},{"1":"2017-07-30","2":"6389690","3":"57462425"},{"1":"2017-08-06","2":"6233255","3":"58626561"},{"1":"2017-08-13","2":"6167533","3":"61417216"},{"1":"2017-08-20","2":"6487694","3":"59700505"},{"1":"2017-08-27","2":"6573919","3":"59203552"},{"1":"2017-09-03","2":"6353101","3":"58975936"},{"1":"2017-09-10","2":"6281075","3":"60682178"},{"1":"2017-09-17","2":"6322028","3":"61128401"},{"1":"2017-09-24","2":"6436003","3":"60897296"},{"1":"2017-10-01","2":"6566325","3":"59258270"},{"1":"2017-10-08","2":"6514220","3":"58066807"},{"1":"2017-10-15","2":"6574221","3":"57515067"},{"1":"2017-10-22","2":"6594969","3":"57560676"},{"1":"2017-10-29","2":"6634297","3":"58450258"},{"1":"2017-11-05","2":"6527862","3":"58620014"},{"1":"2017-11-12","2":"6552978","3":"57411055"},{"1":"2017-11-19","2":"6589219","3":"56351245"},{"1":"2017-11-26","2":"7329651","3":"60497960"},{"1":"2017-12-03","2":"7975501","3":"65448656"},{"1":"2017-12-10","2":"7840166","3":"66274099"},{"1":"2017-12-17","2":"8984392","3":"77632442"},{"1":"2017-12-24","2":"8600238","3":"63800716"},{"1":"2017-12-31","2":"7094323","3":"56793029"},{"1":"2018-01-07","2":"6870002","3":"50831657"},{"1":"2018-01-14","2":"6991513","3":"52079009"},{"1":"2018-01-21","2":"6981959","3":"52314970"},{"1":"2018-01-28","2":"7000187","3":"50642379"},{"1":"2018-02-04","2":"6878098","3":"50723636"},{"1":"2018-02-11","2":"6928693","3":"51877673"},{"1":"2018-02-18","2":"7312801","3":"51313490"},{"1":"2018-02-25","2":"7376682","3":"58164053"},{"1":"2018-03-04","2":"7311333","3":"60596534"},{"1":"2018-03-11","2":"7219855","3":"60861182"},{"1":"2018-03-18","2":"7351333","3":"56762085"},{"1":"2018-03-25","2":"7338904","3":"55578497"},{"1":"2018-04-01","2":"7210715","3":"54897186"},{"1":"2018-04-08","2":"7638906","3":"57766543"},{"1":"2018-04-15","2":"8024212","3":"62921675"},{"1":"2018-04-22","2":"8377625","3":"74953763"},{"1":"2018-04-29","2":"8100646","3":"62715074"},{"1":"2018-05-06","2":"7893350","3":"59640978"},{"1":"2018-05-13","2":"7649154","3":"60139521"},{"1":"2018-05-20","2":"7859856","3":"59290790"},{"1":"2018-05-27","2":"8397087","3":"60186580"},{"1":"2018-06-03","2":"8354560","3":"59608555"},{"1":"2018-06-10","2":"8295721","3":"57321411"},{"1":"2018-06-17","2":"9103653","3":"60784888"},{"1":"2018-06-24","2":"9207930","3":"58820359"},{"1":"2018-07-01","2":"8818919","3":"58350687"},{"1":"2018-07-08","2":"8744804","3":"57196152"},{"1":"2018-07-15","2":"8836175","3":"55481376"},{"1":"2018-07-22","2":"8912585","3":"55674376"},{"1":"2018-07-29","2":"9368540","3":"54558108"},{"1":"2018-08-05","2":"9829448","3":"52554600"},{"1":"2018-08-12","2":"9906687","3":"51444869"},{"1":"2018-08-19","2":"9898121","3":"50851455"},{"1":"2018-08-26","2":"10105085","3":"52316821"},{"1":"2018-09-02","2":"9174147","3":"53295695"},{"1":"2018-09-09","2":"10061693","3":"52217967"},{"1":"2018-09-16","2":"9549335","3":"52495246"},{"1":"2018-09-23","2":"9491921","3":"52542562"},{"1":"2018-09-30","2":"10311351","3":"53289236"},{"1":"2018-10-07","2":"10474952","3":"53167882"},{"1":"2018-10-14","2":"9817948","3":"54699351"},{"1":"2018-10-21","2":"9629039","3":"55686856"},{"1":"2018-10-28","2":"9698251","3":"53904664"},{"1":"2018-11-04","2":"9557680","3":"54293480"},{"1":"2018-11-11","2":"9340503","3":"53978440"},{"1":"2018-11-18","2":"9484414","3":"53871334"},{"1":"2018-11-25","2":"10217990","3":"60204283"},{"1":"2018-12-02","2":"10724804","3":"63167161"},{"1":"2018-12-09","2":"10672749","3":"62086922"},{"1":"2018-12-16","2":"11858217","3":"69676977"},{"1":"2018-12-23","2":"13352779","3":"70341374"},{"1":"2018-12-30","2":"9381104","3":"48623033"},{"1":"2019-01-06","2":"9454079","3":"48358663"},{"1":"2019-01-13","2":"10184422","3":"50033836"},{"1":"2019-01-20","2":"10501999","3":"51531920"},{"1":"2019-01-27","2":"10607532","3":"51622715"},{"1":"2019-02-03","2":"10611347","3":"53436670"},{"1":"2019-02-10","2":"10814685","3":"54811458"},{"1":"2019-02-17","2":"10756763","3":"53062949"},{"1":"2019-02-24","2":"10668243","3":"61231360"},{"1":"2019-03-03","2":"10838916","3":"63089488"},{"1":"2019-03-10","2":"11542267","3":"63070648"},{"1":"2019-03-17","2":"12587709","3":"57907553"},{"1":"2019-03-24","2":"12484040","3":"59622489"},{"1":"2019-03-31","2":"12147418","3":"61396086"},{"1":"2019-04-07","2":"12037677","3":"64501050"},{"1":"2019-04-14","2":"12085668","3":"64302627"},{"1":"2019-04-21","2":"11063034","3":"62063397"},{"1":"2019-04-28","2":"10606324","3":"61195740"},{"1":"2019-05-05","2":"10721762","3":"61179590"},{"1":"2019-05-12","2":"9175810","3":"64162362"},{"1":"2019-05-19","2":"11785543","3":"66182059"},{"1":"2019-05-26","2":"11450679","3":"60471102"},{"1":"2019-06-02","2":"11859801","3":"67385318"},{"1":"2019-06-09","2":"11863200","3":"66792488"},{"1":"2019-06-16","2":"12203011","3":"66015729"},{"1":"2019-06-23","2":"12944558","3":"59674605"},{"1":"2019-06-30","2":"12603219","3":"60434954"},{"1":"2019-07-07","2":"12190141","3":"60409679"},{"1":"2019-07-14","2":"12214762","3":"58192990"},{"1":"2019-07-21","2":"11517456","3":"56838735"},{"1":"2019-07-28","2":"11057405","3":"54786644"},{"1":"2019-08-04","2":"11159869","3":"53572169"},{"1":"2019-08-11","2":"10614307","3":"53102432"},{"1":"2019-08-18","2":"10764191","3":"54326334"},{"1":"2019-08-25","2":"11075215","3":"54990692"},{"1":"2019-09-01","2":"11385671","3":"61685580"},{"1":"2019-09-08","2":"11768547","3":"63201032"},{"1":"2019-09-15","2":"11891137","3":"58195884"},{"1":"2019-09-22","2":"12339671","3":"56475489"},{"1":"2019-09-29","2":"12534512","3":"55388648"},{"1":"2019-10-06","2":"12570974","3":"56213316"},{"1":"2019-10-13","2":"12130776","3":"55458272"},{"1":"2019-10-20","2":"12138057","3":"55765630"},{"1":"2019-10-27","2":"12428253","3":"54536084"},{"1":"2019-11-03","2":"12829031","3":"54128046"},{"1":"2019-11-10","2":"11863437","3":"56792297"},{"1":"2019-11-17","2":"11485691","3":"58857446"},{"1":"2019-11-24","2":"11842684","3":"63285122"},{"1":"2019-12-01","2":"13615723","3":"69302394"},{"1":"2019-12-08","2":"13784812","3":"66689184"},{"1":"2019-12-15","2":"14135110","3":"69729834"},{"1":"2019-12-22","2":"16591888","3":"78477555"},{"1":"2019-12-29","2":"10859375","3":"52613125"},{"1":"2020-01-05","2":"11684918","3":"54684965"},{"1":"2020-01-12","2":"12768413","3":"62520981"},{"1":"2020-01-19","2":"12469021","3":"64383133"},{"1":"2020-01-26","2":"12385678","3":"61578360"},{"1":"2020-02-02","2":"11860183","3":"59243997"},{"1":"2020-02-09","2":"12539941","3":"57951071"},{"1":"2020-02-16","2":"12247738","3":"56180328"},{"1":"2020-02-23","2":"11865790","3":"59095788"},{"1":"2020-03-01","2":"12117208","3":"60714300"},{"1":"2020-03-08","2":"11485139","3":"63165796"},{"1":"2020-03-15","2":"11123890","3":"56869946"},{"1":"2020-03-22","2":"11000026","3":"56613893"},{"1":"2020-03-29","2":"10695164","3":"56993066"},{"1":"2020-04-05","2":"10832377","3":"58005108"},{"1":"2020-04-12","2":"10767502","3":"54400674"},{"1":"2020-04-19","2":"11044092","3":"54567926"},{"1":"2020-04-26","2":"11458096","3":"52955805"},{"1":"2020-05-03","2":"11557207","3":"52797787"},{"1":"2020-05-10","2":"11290500","3":"53669537"},{"1":"2020-05-17","2":"11420307","3":"54971848"},{"1":"2020-05-24","2":"11594740","3":"59703269"},{"1":"2020-05-31","2":"12031735","3":"56234708"},{"1":"2020-06-07","2":"11678290","3":"55459464"},{"1":"2020-06-14","2":"11444403","3":"63778995"},{"1":"2020-06-21","2":"12108934","3":"57346797"},{"1":"2020-06-28","2":"12381525","3":"54303152"},{"1":"2020-07-05","2":"12581848","3":"52759080"},{"1":"2020-07-12","2":"12561026","3":"52722096"},{"1":"2020-07-19","2":"12843394","3":"50403416"},{"1":"2020-07-26","2":"13207944","3":"49056566"},{"1":"2020-08-02","2":"12761873","3":"50404184"},{"1":"2020-08-09","2":"12465932","3":"49776530"},{"1":"2020-08-16","2":"12337469","3":"48766818"},{"1":"2020-08-23","2":"12567150","3":"50032662"},{"1":"2020-08-30","2":"12571707","3":"51258093"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>As another intermediate step, we need to compute the ratio between the two variables we would like to plot on the two axis, since the scale of the second axis is determined based on the ratio with the other variable.</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="metrics-and-kpis-in-retail.html#cb222-1" tabindex="-1"></a>ratio <span class="ot">&lt;-</span> <span class="fu">mean</span>(data_wide<span class="sc">$</span>at<span class="sc">/</span><span class="dv">1000000</span>)<span class="sc">/</span><span class="fu">mean</span>(data_wide<span class="sc">$</span>se<span class="sc">/</span><span class="dv">1000000</span>)</span></code></pre></div>
<p>Now we can create the plot with the secondary y-axis as follows:</p>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb223-1"><a href="metrics-and-kpis-in-retail.html#cb223-1" tabindex="-1"></a><span class="fu">ggplot</span>(data_wide) <span class="sc">+</span> <span class="fu">geom_area</span>(<span class="fu">aes</span>(<span class="at">x =</span> week, <span class="at">y =</span> at<span class="sc">/</span><span class="dv">1000000</span>,</span>
<span id="cb223-2"><a href="metrics-and-kpis-in-retail.html#cb223-2" tabindex="-1"></a>    <span class="at">colour =</span> <span class="st">&quot;Austria&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;Austria&quot;</span>), <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb223-3"><a href="metrics-and-kpis-in-retail.html#cb223-3" tabindex="-1"></a>    <span class="fu">geom_area</span>(<span class="fu">aes</span>(<span class="at">x =</span> week, <span class="at">y =</span> (se<span class="sc">/</span><span class="dv">1000000</span>) <span class="sc">*</span> ratio,</span>
<span id="cb223-4"><a href="metrics-and-kpis-in-retail.html#cb223-4" tabindex="-1"></a>        <span class="at">colour =</span> <span class="st">&quot;Sweden&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;Sweden&quot;</span>), <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb223-5"><a href="metrics-and-kpis-in-retail.html#cb223-5" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">sec.axis =</span> <span class="fu">sec_axis</span>(<span class="sc">~</span>.<span class="sc">/</span>ratio,</span>
<span id="cb223-6"><a href="metrics-and-kpis-in-retail.html#cb223-6" tabindex="-1"></a>        <span class="at">name =</span> <span class="st">&quot;Total streams SE (in million)&quot;</span>)) <span class="sc">+</span></span>
<span id="cb223-7"><a href="metrics-and-kpis-in-retail.html#cb223-7" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;#999999&quot;</span>, <span class="st">&quot;#E69F00&quot;</span>)) <span class="sc">+</span></span>
<span id="cb223-8"><a href="metrics-and-kpis-in-retail.html#cb223-8" tabindex="-1"></a>    <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;#999999&quot;</span>, <span class="st">&quot;#E69F00&quot;</span>),</span>
<span id="cb223-9"><a href="metrics-and-kpis-in-retail.html#cb223-9" tabindex="-1"></a>        <span class="at">guide =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> <span class="fu">theme_minimal</span>() <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Week&quot;</span>,</span>
<span id="cb223-10"><a href="metrics-and-kpis-in-retail.html#cb223-10" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Total streams AT (in million)&quot;</span>, <span class="at">title =</span> <span class="st">&quot;Weekly number of streams by country&quot;</span>) <span class="sc">+</span></span>
<span id="cb223-11"><a href="metrics-and-kpis-in-retail.html#cb223-11" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">&quot;#666666&quot;</span>),</span>
<span id="cb223-12"><a href="metrics-and-kpis-in-retail.html#cb223-12" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_blank</span>(), <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-46"></span>
<img src="06-retail_metrics_files/figure-html/unnamed-chunk-46-1.png" alt="Secondary y-axis" width="672" />
<p class="caption">
Figure 5.7: Secondary y-axis
</p>
</div>
<p>In this plot it is easy to see the difference in trends between the countries.</p>
</div>
</div>
<div id="saving-plots-1" class="section level3 hasAnchor" number="5.0.8">
<h3><span class="header-section-number">5.0.8</span> Saving plots<a href="metrics-and-kpis-in-retail.html#saving-plots-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To save the last displayed plot, simply use the function <code>ggsave()</code>, and it will save the plot to your working directory. Use the arguments <code>height</code>and <code>width</code> to specify the size of the file. You may also choose the file format by adjusting the ending of the file name. E.g., <code>file_name.jpg</code> will create a file in JPG-format, whereas <code>file_name.png</code> saves the file in PNG-format, etc..</p>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="metrics-and-kpis-in-retail.html#cb224-1" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&quot;test_plot.jpg&quot;</span>, <span class="at">height =</span> <span class="dv">5</span>, <span class="at">width =</span> <span class="fl">8.5</span>)</span></code></pre></div>
</div>
<div id="ggplot-extensions-1" class="section level3 hasAnchor" number="5.0.9">
<h3><span class="header-section-number">5.0.9</span> ggplot extensions<a href="metrics-and-kpis-in-retail.html#ggplot-extensions-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<br>
<div align="center">
<iframe width="560" height="315" src="https://www.youtube.com/embed/X8zGovLeCrk" frameborder="0" allowfullscreen>
</iframe>
</div>
<p><br></p>
<p>As the ggplot2 package became more and more popular over the past years, more and more extensions have been developed by users that can be used for specific purposes that are not yet covered by the standard functionality of ggplot2. You can find a list of the extensions <a href="https://exts.ggplot2.tidyverse.org/gallery/" target="_blank">here</a>. Below, you can find some example for the additional options.</p>
<div id="results-of-statistical-tests-ggstatsplot-1" class="section level4 hasAnchor" number="5.0.9.1">
<h4><span class="header-section-number">5.0.9.1</span> Results of statistical tests (ggstatsplot)<a href="metrics-and-kpis-in-retail.html#results-of-statistical-tests-ggstatsplot-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>You may use the <a href="https://indrajeetpatil.github.io/ggstatsplot/index.html" target="_blank">ggstatplot</a> package to augment your plots with the results from statistical tests, such as an ANOVA. You can find a presentation about the capabilities of this package <a href="https://indrajeetpatil.github.io/ggstatsplot_slides/slides/ggstatsplot_presentation.html#1" target="_blank">here</a>. The boxplot below shows an example.</p>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="metrics-and-kpis-in-retail.html#cb225-1" tabindex="-1"></a><span class="fu">library</span>(ggstatsplot)</span>
<span id="cb225-2"><a href="metrics-and-kpis-in-retail.html#cb225-2" tabindex="-1"></a>music_data_subs <span class="ot">&lt;-</span> <span class="fu">filter</span>(music_data, genre <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;HipHop/Rap&quot;</span>, <span class="st">&quot;Soundtrack&quot;</span>,<span class="st">&quot;Pop&quot;</span>,<span class="st">&quot;Rock&quot;</span>))</span>
<span id="cb225-3"><a href="metrics-and-kpis-in-retail.html#cb225-3" tabindex="-1"></a><span class="fu">ggbetweenstats</span>(</span>
<span id="cb225-4"><a href="metrics-and-kpis-in-retail.html#cb225-4" tabindex="-1"></a>   <span class="at">data =</span> music_data_subs,</span>
<span id="cb225-5"><a href="metrics-and-kpis-in-retail.html#cb225-5" tabindex="-1"></a>   <span class="at">title =</span> <span class="st">&quot;Number of streams by genre&quot;</span>, <span class="co"># title for the plot</span></span>
<span id="cb225-6"><a href="metrics-and-kpis-in-retail.html#cb225-6" tabindex="-1"></a>   <span class="at">plot.type =</span> <span class="st">&quot;box&quot;</span>,</span>
<span id="cb225-7"><a href="metrics-and-kpis-in-retail.html#cb225-7" tabindex="-1"></a>   <span class="at">x =</span> genre, <span class="co"># 4 groups</span></span>
<span id="cb225-8"><a href="metrics-and-kpis-in-retail.html#cb225-8" tabindex="-1"></a>   <span class="at">y =</span> log_streams,</span>
<span id="cb225-9"><a href="metrics-and-kpis-in-retail.html#cb225-9" tabindex="-1"></a>   <span class="at">type =</span> <span class="st">&quot;p&quot;</span>, <span class="co"># default</span></span>
<span id="cb225-10"><a href="metrics-and-kpis-in-retail.html#cb225-10" tabindex="-1"></a>   <span class="at">messages =</span> <span class="cn">FALSE</span>,</span>
<span id="cb225-11"><a href="metrics-and-kpis-in-retail.html#cb225-11" tabindex="-1"></a>   <span class="at">bf.message =</span> <span class="cn">FALSE</span>,</span>
<span id="cb225-12"><a href="metrics-and-kpis-in-retail.html#cb225-12" tabindex="-1"></a>   <span class="at">pairwise.comparisons =</span> <span class="cn">TRUE</span> <span class="co"># display results from pairwise comparisons</span></span>
<span id="cb225-13"><a href="metrics-and-kpis-in-retail.html#cb225-13" tabindex="-1"></a> )</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-48"></span>
<img src="06-retail_metrics_files/figure-html/unnamed-chunk-48-1.png" alt="Boxplot using ggstatsplot package" width="672" />
<p class="caption">
Figure 5.8: Boxplot using ggstatsplot package
</p>
</div>
<div id="combination-of-plots-ggextra-1" class="section level5 hasAnchor" number="5.0.9.1.1">
<h5><span class="header-section-number">5.0.9.1.1</span> Combination of plots (ggExtra)<a href="metrics-and-kpis-in-retail.html#combination-of-plots-ggextra-1" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Using the <code>ggExtra()</code> package, you may combine two type of plots. For example, the following plot combines a scatterplot with a histogram:</p>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb226-1"><a href="metrics-and-kpis-in-retail.html#cb226-1" tabindex="-1"></a><span class="fu">library</span>(ggExtra)</span>
<span id="cb226-2"><a href="metrics-and-kpis-in-retail.html#cb226-2" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(music_data, <span class="fu">aes</span>(<span class="at">x =</span> speechiness, <span class="at">y =</span> log_streams)) <span class="sc">+</span></span>
<span id="cb226-3"><a href="metrics-and-kpis-in-retail.html#cb226-3" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Speechiness&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Number of streams (log-scale)&quot;</span>,</span>
<span id="cb226-4"><a href="metrics-and-kpis-in-retail.html#cb226-4" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Scatterplot &amp; histograms of streams and speechiness&quot;</span>) <span class="sc">+</span></span>
<span id="cb226-5"><a href="metrics-and-kpis-in-retail.html#cb226-5" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>,</span>
<span id="cb226-6"><a href="metrics-and-kpis-in-retail.html#cb226-6" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;#666666&quot;</span>))</span>
<span id="cb226-7"><a href="metrics-and-kpis-in-retail.html#cb226-7" tabindex="-1"></a>ggExtra<span class="sc">::</span><span class="fu">ggMarginal</span>(p, <span class="at">type =</span> <span class="st">&quot;histogram&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-49"></span>
<img src="06-retail_metrics_files/figure-html/unnamed-chunk-49-1.png" alt="Scatter plot with histogram" width="672" />
<p class="caption">
Figure 4.11: Scatter plot with histogram
</p>
</div>
<p>In this case, the <code>type = "histogram"</code> argument specifies that we would like to plot a histogram. However, you could also opt for <code>type = "boxplot"</code> or <code>type = "density"</code> to use a boxplot or density plot instead.</p>
</div>
</div>
<div id="appendix-1" class="section level4 hasAnchor" number="5.0.9.2">
<h4><span class="header-section-number">5.0.9.2</span> Appendix<a href="metrics-and-kpis-in-retail.html#appendix-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div id="covariation-plots-1" class="section level5 hasAnchor" number="5.0.9.2.1">
<h5><span class="header-section-number">5.0.9.2.1</span> Covariation plots<a href="metrics-and-kpis-in-retail.html#covariation-plots-1" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>To visualize the co-variation between categorical variables, you’ll need to count the number of observations for each combination stored in the frequency table. Say, we wanted to investigate the association between the popularity of a song and the level of ‘speechiness’. For this exercise, let’s assume we have both variables measured as categorical (factor) variables. We can use the <code>quantcut()</code> function to create categorical variables based on the continuous variables. All we need to do is tell the function how many categories we would like to obtain and it will divide the data based on the percentiles equally.</p>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="metrics-and-kpis-in-retail.html#cb227-1" tabindex="-1"></a><span class="fu">library</span>(gtools)</span>
<span id="cb227-2"><a href="metrics-and-kpis-in-retail.html#cb227-2" tabindex="-1"></a>music_data<span class="sc">$</span>streams_cat <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">quantcut</span>(music_data<span class="sc">$</span>streams,</span>
<span id="cb227-3"><a href="metrics-and-kpis-in-retail.html#cb227-3" tabindex="-1"></a>    <span class="dv">5</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb227-4"><a href="metrics-and-kpis-in-retail.html#cb227-4" tabindex="-1"></a>music_data<span class="sc">$</span>speech_cat <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">quantcut</span>(music_data<span class="sc">$</span>speechiness,</span>
<span id="cb227-5"><a href="metrics-and-kpis-in-retail.html#cb227-5" tabindex="-1"></a>    <span class="dv">3</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb227-6"><a href="metrics-and-kpis-in-retail.html#cb227-6" tabindex="-1"></a></span>
<span id="cb227-7"><a href="metrics-and-kpis-in-retail.html#cb227-7" tabindex="-1"></a>music_data<span class="sc">$</span>streams_cat <span class="ot">&lt;-</span> <span class="fu">factor</span>(music_data<span class="sc">$</span>streams_cat,</span>
<span id="cb227-8"><a href="metrics-and-kpis-in-retail.html#cb227-8" tabindex="-1"></a>    <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;low&quot;</span>, <span class="st">&quot;low-med&quot;</span>, <span class="st">&quot;medium&quot;</span>,</span>
<span id="cb227-9"><a href="metrics-and-kpis-in-retail.html#cb227-9" tabindex="-1"></a>        <span class="st">&quot;med-high&quot;</span>, <span class="st">&quot;high&quot;</span>))  <span class="co">#convert to factor</span></span>
<span id="cb227-10"><a href="metrics-and-kpis-in-retail.html#cb227-10" tabindex="-1"></a>music_data<span class="sc">$</span>speech_cat <span class="ot">&lt;-</span> <span class="fu">factor</span>(music_data<span class="sc">$</span>speech_cat,</span>
<span id="cb227-11"><a href="metrics-and-kpis-in-retail.html#cb227-11" tabindex="-1"></a>    <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;low&quot;</span>, <span class="st">&quot;medium&quot;</span>, <span class="st">&quot;high&quot;</span>))  <span class="co">#convert to factor</span></span></code></pre></div>
<p>Now we have multiple ways to visualize a relationship between the two variables with ggplot. One option would be to use a variation of the scatterplot which counts how many points overlap at any given point and increases the dot size accordingly. This can be achieved with <code>geom_count()</code> as the example below shows where the <code>stat(prop)</code> argument assures that we get relative frequencies and with the <code>group</code> argument we tell R to compute the relative frequencies by speechiness.</p>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb228-1"><a href="metrics-and-kpis-in-retail.html#cb228-1" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> music_data) <span class="sc">+</span> <span class="fu">geom_count</span>(<span class="fu">aes</span>(<span class="at">x =</span> speech_cat,</span>
<span id="cb228-2"><a href="metrics-and-kpis-in-retail.html#cb228-2" tabindex="-1"></a>    <span class="at">y =</span> streams_cat, <span class="at">size =</span> <span class="fu">stat</span>(prop), <span class="at">group =</span> speech_cat)) <span class="sc">+</span></span>
<span id="cb228-3"><a href="metrics-and-kpis-in-retail.html#cb228-3" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">&quot;Popularity&quot;</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&quot;Speechiness&quot;</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">size =</span> <span class="st">&quot;Proportion&quot;</span>) <span class="sc">+</span></span>
<span id="cb228-4"><a href="metrics-and-kpis-in-retail.html#cb228-4" tabindex="-1"></a>    <span class="fu">theme_bw</span>()</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-51"></span>
<img src="06-retail_metrics_files/figure-html/unnamed-chunk-51-1.png" alt="Covariation between categorical data (1)" width="672" />
<p class="caption">
Figure 5.9: Covariation between categorical data (1)
</p>
</div>
<p>The plot shows that there appears to be a positive association between the popularity of a song and its level of speechiness.</p>
<p>Another option would be to use a tile plot that changes the color of the tile based on the frequency of the combination of factors. To achieve this, we first have to create a dataframe that contains the relative frequencies of all combinations of factors. Then we can take this dataframe and pass it to <code>geom_tile()</code>, while specifying that the fill of each tile should be dependent on the observed frequency of the factor combination, which is done by specifying the fill in the <code>aes()</code> function.</p>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb229-1"><a href="metrics-and-kpis-in-retail.html#cb229-1" tabindex="-1"></a>table_plot_rel <span class="ot">&lt;-</span> <span class="fu">prop.table</span>(<span class="fu">table</span>(music_data[, <span class="fu">c</span>(<span class="st">&quot;speech_cat&quot;</span>,</span>
<span id="cb229-2"><a href="metrics-and-kpis-in-retail.html#cb229-2" tabindex="-1"></a>    <span class="st">&quot;streams_cat&quot;</span>)]), <span class="dv">1</span>)</span>
<span id="cb229-3"><a href="metrics-and-kpis-in-retail.html#cb229-3" tabindex="-1"></a>table_plot_rel <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(table_plot_rel)</span>
<span id="cb229-4"><a href="metrics-and-kpis-in-retail.html#cb229-4" tabindex="-1"></a></span>
<span id="cb229-5"><a href="metrics-and-kpis-in-retail.html#cb229-5" tabindex="-1"></a><span class="fu">ggplot</span>(table_plot_rel, <span class="fu">aes</span>(<span class="at">x =</span> speech_cat, <span class="at">y =</span> streams_cat)) <span class="sc">+</span></span>
<span id="cb229-6"><a href="metrics-and-kpis-in-retail.html#cb229-6" tabindex="-1"></a>    <span class="fu">geom_tile</span>(<span class="fu">aes</span>(<span class="at">fill =</span> Freq)) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">&quot;Populartiy&quot;</span>) <span class="sc">+</span></span>
<span id="cb229-7"><a href="metrics-and-kpis-in-retail.html#cb229-7" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">&quot;Speechiness&quot;</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>()</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-52"></span>
<img src="06-retail_metrics_files/figure-html/unnamed-chunk-52-1.png" alt="Covariation between categorical data (2)" width="672" />
<p class="caption">
Figure 4.13: Covariation between categorical data (2)
</p>
</div>
</div>
<div id="location-data-ggmap-1" class="section level5 hasAnchor" number="5.0.9.2.2">
<h5><span class="header-section-number">5.0.9.2.2</span> Location data (ggmap)<a href="metrics-and-kpis-in-retail.html#location-data-ggmap-1" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Now that we have covered the most important plots, we can look at what other type of data you may come across. One type of data that is increasingly available is the geo-location of customers and users (e.g., from app usage data). The following data set contains the app usage data of Shazam users from Germany. The data contains the latitude and longitude information where a music track was “shazamed”.</p>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb230-1"><a href="metrics-and-kpis-in-retail.html#cb230-1" tabindex="-1"></a><span class="fu">library</span>(ggmap)</span>
<span id="cb230-2"><a href="metrics-and-kpis-in-retail.html#cb230-2" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb230-3"><a href="metrics-and-kpis-in-retail.html#cb230-3" tabindex="-1"></a>geo_data <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;https://raw.githubusercontent.com/IMSMWU/Teaching/master/MRDA2017/geo_data.dat&quot;</span>,</span>
<span id="cb230-4"><a href="metrics-and-kpis-in-retail.html#cb230-4" tabindex="-1"></a>    <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>, <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb230-5"><a href="metrics-and-kpis-in-retail.html#cb230-5" tabindex="-1"></a><span class="fu">head</span>(geo_data)</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["lat"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["lon"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["latlon"],"name":[3],"type":["chr"],"align":["left"]}],"data":[{"1":"50.7","2":"7.7","3":"50.7_7.7"},{"1":"51.0","2":"6.3","3":"51_6.3"},{"1":"52.2","2":"10.5","3":"52.2_10.5"},{"1":"50.9","2":"11.0","3":"50.9_11"},{"1":"49.9","2":"8.2","3":"49.9_8.2"},{"1":"53.3","2":"13.4","3":"53.3_13.4"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>There is a package called “ggmap”, which is an augmentation for the ggplot packages. It lets you load maps from different web services (e.g., Google maps) and maps the user location within the coordination system of ggplot. With this information, you can create interesting plots like heat maps. We won’t go into detail here but you may go through the following code on your own if you are interested. However, please note that you need to register an API with Google in order to make use of this package.</p>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb231-1"><a href="metrics-and-kpis-in-retail.html#cb231-1" tabindex="-1"></a><span class="co"># register_google(key = &#39;your_api_key&#39;)</span></span>
<span id="cb231-2"><a href="metrics-and-kpis-in-retail.html#cb231-2" tabindex="-1"></a></span>
<span id="cb231-3"><a href="metrics-and-kpis-in-retail.html#cb231-3" tabindex="-1"></a><span class="co"># Download the base map</span></span>
<span id="cb231-4"><a href="metrics-and-kpis-in-retail.html#cb231-4" tabindex="-1"></a>de_map_g_str <span class="ot">&lt;-</span> <span class="fu">get_map</span>(<span class="at">location =</span> <span class="fu">c</span>(<span class="fl">10.018343</span>, <span class="fl">51.133481</span>),</span>
<span id="cb231-5"><a href="metrics-and-kpis-in-retail.html#cb231-5" tabindex="-1"></a>    <span class="at">zoom =</span> <span class="dv">6</span>, <span class="at">scale =</span> <span class="dv">2</span>)  <span class="co"># results in below map (wohoo!)</span></span>
<span id="cb231-6"><a href="metrics-and-kpis-in-retail.html#cb231-6" tabindex="-1"></a></span>
<span id="cb231-7"><a href="metrics-and-kpis-in-retail.html#cb231-7" tabindex="-1"></a><span class="co"># Draw the heat map</span></span>
<span id="cb231-8"><a href="metrics-and-kpis-in-retail.html#cb231-8" tabindex="-1"></a><span class="fu">ggmap</span>(de_map_g_str, <span class="at">extent =</span> <span class="st">&quot;device&quot;</span>) <span class="sc">+</span> <span class="fu">geom_density2d</span>(<span class="at">data =</span> geo_data,</span>
<span id="cb231-9"><a href="metrics-and-kpis-in-retail.html#cb231-9" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> lon, <span class="at">y =</span> lat), <span class="at">size =</span> <span class="fl">0.3</span>) <span class="sc">+</span> <span class="fu">stat_density2d</span>(<span class="at">data =</span> geo_data,</span>
<span id="cb231-10"><a href="metrics-and-kpis-in-retail.html#cb231-10" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> lon, <span class="at">y =</span> lat, <span class="at">fill =</span> ..level.., <span class="at">alpha =</span> ..level..),</span>
<span id="cb231-11"><a href="metrics-and-kpis-in-retail.html#cb231-11" tabindex="-1"></a>    <span class="at">size =</span> <span class="fl">0.01</span>, <span class="at">bins =</span> <span class="dv">16</span>, <span class="at">geom =</span> <span class="st">&quot;polygon&quot;</span>) <span class="sc">+</span> <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">&quot;green&quot;</span>,</span>
<span id="cb231-12"><a href="metrics-and-kpis-in-retail.html#cb231-12" tabindex="-1"></a>    <span class="at">high =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span> <span class="fu">scale_alpha</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.3</span>),</span>
<span id="cb231-13"><a href="metrics-and-kpis-in-retail.html#cb231-13" tabindex="-1"></a>    <span class="at">guide =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p><img src="06-retail_metrics_files/figure-html/ggmaps-1.png" width="672" /></p>
</div>
</div>
</div>
<div id="learning-check-3" class="section level2 unnumbered hasAnchor">
<h2>Learning check<a href="metrics-and-kpis-in-retail.html#learning-check-3" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><strong>(LC4.1) For which data types is it meaningful to compute the mean?</strong></p>
<ul class="task-list">
<li><label><input type="checkbox" />Nominal</label></li>
<li><label><input type="checkbox" />Ordinal</label></li>
<li><label><input type="checkbox" checked="" />Interval</label></li>
<li><label><input type="checkbox" checked="" />Ratio</label></li>
</ul>
<p><strong>(LC4.2) How can you compute the standardized variate of a variable X?</strong></p>
<ul class="task-list">
<li><label><input type="checkbox" checked="" /><span class="math inline">\(Z=\frac{X_i-\bar{X}}{s}\)</span></label></li>
<li><label><input type="checkbox" /><span class="math inline">\(Z=\frac{\bar{X}+X_i}{s}\)</span></label></li>
<li><label><input type="checkbox" /><span class="math inline">\(Z=\frac{s}{\bar{X}+X_i}\)</span></label></li>
<li><label><input type="checkbox" /><span class="math inline">\(Z=s*({\bar{X}+X_i)}\)</span></label></li>
<li><label><input type="checkbox" />None of the above</label></li>
</ul>
<p><strong>You wish to analyze the following data frame ‘df’ containing information about cars</strong></p>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["mpg"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["cyl"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["disp"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["hp"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["drat"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["wt"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["qsec"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["vs"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["am"],"name":[9],"type":["dbl"],"align":["right"]},{"label":["gear"],"name":[10],"type":["dbl"],"align":["right"]},{"label":["carb"],"name":[11],"type":["dbl"],"align":["right"]}],"data":[{"1":"21.0","2":"6","3":"160","4":"110","5":"3.90","6":"2.620","7":"16.46","8":"0","9":"1","10":"4","11":"4"},{"1":"21.0","2":"6","3":"160","4":"110","5":"3.90","6":"2.875","7":"17.02","8":"0","9":"1","10":"4","11":"4"},{"1":"22.8","2":"4","3":"108","4":"93","5":"3.85","6":"2.320","7":"18.61","8":"1","9":"1","10":"4","11":"1"},{"1":"21.4","2":"6","3":"258","4":"110","5":"3.08","6":"3.215","7":"19.44","8":"1","9":"0","10":"3","11":"1"},{"1":"18.7","2":"8","3":"360","4":"175","5":"3.15","6":"3.440","7":"17.02","8":"0","9":"0","10":"3","11":"2"},{"1":"18.1","2":"6","3":"225","4":"105","5":"2.76","6":"3.460","7":"20.22","8":"1","9":"0","10":"3","11":"1"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p><strong>(LC4.3) How could you add a new variable containing the z-scores of the variable ‘mpg’ in R?</strong></p>
<ul class="task-list">
<li><label><input type="checkbox" /><code>df$mpg_std &lt;- zscore(df$mpg)</code></label></li>
<li><label><input type="checkbox" /><code>df$mpg_std &lt;- stdv(df$mpg)</code></label></li>
<li><label><input type="checkbox" /><code>df$mpg_std &lt;- std.scale(df$mpg)</code></label></li>
<li><label><input type="checkbox" checked="" /><code>df$mpg_std &lt;- scale(df$mpg)</code></label></li>
<li><label><input type="checkbox" />None of the above</label></li>
</ul>
<p><strong>(LC4.4) How could you produce the below output?</strong></p>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["vars"],"name":[1],"type":["int"],"align":["right"]},{"label":["n"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["mean"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["sd"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["median"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["trimmed"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["mad"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["min"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["max"],"name":[9],"type":["dbl"],"align":["right"]},{"label":["range"],"name":[10],"type":["dbl"],"align":["right"]},{"label":["skew"],"name":[11],"type":["dbl"],"align":["right"]},{"label":["kurtosis"],"name":[12],"type":["dbl"],"align":["right"]},{"label":["se"],"name":[13],"type":["dbl"],"align":["right"]}],"data":[{"1":"1","2":"32","3":"146.68750","4":"68.562868","5":"123.00","6":"141.19231","7":"77.095200","8":"52.0","9":"335.0","10":"283.0","11":"0.7260237","12":"-0.1355511","13":"12.1203173"},{"1":"2","2":"32","3":"20.09062","4":"6.026948","5":"19.20","6":"19.69615","7":"5.411490","8":"10.4","9":"33.9","10":"23.5","11":"0.6106550","12":"-0.3727660","13":"1.0654240"},{"1":"3","2":"32","3":"17.84875","4":"1.786943","5":"17.71","6":"17.82769","7":"1.415883","8":"14.5","9":"22.9","10":"8.4","11":"0.3690453","12":"0.3351142","13":"0.3158899"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<ul class="task-list">
<li><label><input type="checkbox" checked="" /><code>describe(select(mtcars, hp, mpg, qsec))</code></label></li>
<li><label><input type="checkbox" /><code>summary(select(mtcars, hp, mpg, qsec))</code></label></li>
<li><label><input type="checkbox" /><code>table(select(mtcars, hp, mpg, qsec))</code></label></li>
<li><label><input type="checkbox" /><code>str(select(mtcars, hp, mpg, qsec))</code></label></li>
<li><label><input type="checkbox" />None of the above</label></li>
</ul>
<p><strong>(LC4.5) The last column “carb” indicates the number of carburetors each model has. By using a function we got to know the number of car models that have a certain number carburetors. Which function helped us to obtain this information?</strong></p>
<pre><code>## 
##  1  2  3  4  6  8 
##  7 10  3 10  1  1</code></pre>
<ul class="task-list">
<li><label><input type="checkbox" /><code>describe(mtcars$carb)</code></label></li>
<li><label><input type="checkbox" checked="" /><code>table(mtcars$carb)</code></label></li>
<li><label><input type="checkbox" /><code>str(mtcars$carb)</code></label></li>
<li><label><input type="checkbox" /><code>prop.table(mtcars$carb)</code></label></li>
<li><label><input type="checkbox" />None of the above</label></li>
</ul>
<p><strong>(LC4.6) What type of data can be meaningfully depicted in a scatter plot?</strong></p>
<ul class="task-list">
<li><label><input type="checkbox" />Two categorical variables</label></li>
<li><label><input type="checkbox" />One categorical and one continuous variable</label></li>
<li><label><input type="checkbox" checked="" />Two continuous variables</label></li>
<li><label><input type="checkbox" />One continuous variable</label></li>
<li><label><input type="checkbox" />None of the above</label></li>
</ul>
<p><strong>(LC4.7) Which statement about the graph below is true?</strong></p>
<p><img src="06-retail_metrics_files/figure-html/unnamed-chunk-57-1.png" width="672" /></p>
<ul class="task-list">
<li><label><input type="checkbox" />This is a bar chart</label></li>
<li><label><input type="checkbox" checked="" />This is a histogram</label></li>
<li><label><input type="checkbox" checked="" />It shows the frequency distribution of a continuous variable</label></li>
<li><label><input type="checkbox" />It shows the frequency distribution of a categorical variable</label></li>
<li><label><input type="checkbox" />None of the above</label></li>
</ul>
<p><strong>(LC4.8) Which statement about the graph below is true?</strong></p>
<p><img src="06-retail_metrics_files/figure-html/unnamed-chunk-58-1.png" width="50%" /></p>
<ul class="task-list">
<li><label><input type="checkbox" />This is a bar chart</label></li>
<li><label><input type="checkbox" checked="" />50% of observations are contained in the gray area</label></li>
<li><label><input type="checkbox" />The horizontal black line indicates the mean</label></li>
<li><label><input type="checkbox" checked="" />This is a boxplot</label></li>
<li><label><input type="checkbox" />None of the above</label></li>
</ul>
<p><strong>(LC4.9) Which function can help you to save a graph made with <code>ggplot()</code>?</strong></p>
<ul class="task-list">
<li><label><input type="checkbox" checked="" /><code>ggsave()</code></label></li>
<li><label><input type="checkbox" /><code>write.plot()</code></label></li>
<li><label><input type="checkbox" /><code>save.plot()</code></label></li>
<li><label><input type="checkbox" /><code>export.plot()</code></label></li>
</ul>
<p><strong>(LC4.10) For a variable that follows a normal distribution, within how many standard deviations of the mean are 95% of values?</strong></p>
<ul class="task-list">
<li><label><input type="checkbox" />1.645</label></li>
<li><label><input type="checkbox" checked="" />1.960</label></li>
<li><label><input type="checkbox" />2.580</label></li>
<li><label><input type="checkbox" />3.210</label></li>
<li><label><input type="checkbox" />None of the above</label></li>
</ul>
</div>
<div id="references-2" class="section level2 unnumbered hasAnchor">
<h2>References<a href="metrics-and-kpis-in-retail.html#references-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>Field, A., Miles J., &amp; Field, Z. (2012). Discovering Statistics Using R. Sage Publications.</li>
<li>Chang, W. (2020). R Graphics Cookbook, 2nd edition (<a href="https://r-graphics.org/" class="uri">https://r-graphics.org/</a>)</li>
<li>Grolemund, G. &amp; Wickham, H. (2020). R for Data Science (<a href="https://r4ds.had.co.nz/" class="uri">https://r4ds.had.co.nz/</a>)</li>
</ul>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="summarizing-data.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="statistical-inference.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
